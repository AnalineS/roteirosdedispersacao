# ============================================================================
# REQUIREMENTS CONSOLIDADO - Sistema Educacional Hansen√≠ase
# SECURITY UPDATE APPLIED - September 25, 2025
# Addresses critical vulnerabilities: CVE-2025-59420, CVE-2025-3730, CVE-2024-47874
# ============================================================================

# === CORE FLASK ===
# SECURITY: CRITICAL - Updated 2024-09-24 - Latest Flask security patches
Flask==3.1.2
Flask-CORS==6.0.1  # SECURITY UPDATE: CVE-2024-6221, CVE-2024-6839, CVE-2024-6844, CVE-2024-6866
Werkzeug==3.1.3
gunicorn==23.0.0   # SECURITY: Updated 2024-09-24 - CVE-2024-6827 fixed

# === AI & ML CORE ===
# SECURITY UPDATE: PyTorch vulnerability fix
openai>=1.50.0
sentence-transformers==5.1.0
chromadb>=0.4.0
numpy==2.3.3      # SECURITY UPDATE: Latest stable version (breaking changes - test thoroughly)
# FALLBACK if numpy 2.x breaks compatibility: numpy==1.26.4
torch==2.8.0      # SECURITY UPDATE: CVE-2025-3730 fix - torch.nn.functional.ctc_loss DoS
scikit-learn==1.6.1

# === AUTHENTICATION & JWT ===
# CRITICAL SECURITY FIX: JWT vulnerability
authlib==1.6.4    # SECURITY UPDATE: CVE-2025-59420 fix - JWT/JWS critical header vulnerability
PyJWT==2.10.1      # SECURITY: Latest secure version
cryptography==46.0.1  # SECURITY: CRITICAL - Updated 2024-09-24 - Latest security patches
passlib>=1.7.4     # Password hashing

# === WEB FRAMEWORK SECURITY UPDATES ===
# SECURITY UPDATE: FastAPI/Starlette vulnerabilities
fastapi==0.118.6   # SECURITY UPDATE: Latest stable version
starlette==0.40.0  # SECURITY UPDATE: CVE-2024-47874 fix - Multipart DoS vulnerability

# === SECURITY FRAMEWORK ===
# Rate limiting and middleware security
Flask-Limiter>=3.0.0
limits>=3.6.0

# Input validation and sanitization
bleach==6.2.0      # SECURITY: Latest secure version
email-validator>=2.0.0
validators>=0.22.0
defusedxml==0.7.1
markupsafe==3.0.2

# Secrets management
pynacl>=1.5.0

# User agent analysis and IP validation
user-agents>=2.2.0
ipaddress>=1.0.23

# === VALIDATION & DATA ===
pydantic==2.11.9   # SECURITY: Updated 2024-09-24 - Performance improvements and security patches
jsonschema>=4.23.0

# === HTTP & NETWORKING ===
requests==2.32.5   # SECURITY: CRITICAL - Updated 2024-09-24 - Latest security patches
httpx>=0.24.0
urllib3>=2.5.0    # SECURITY: CRITICAL - Updated 2024-09-24 - Resolves CVE-2025-50181 (High severity)
certifi==2025.8.3  # SECURITY: Updated 2024-09-24 - Latest certificate bundle

# === CACHE & PERFORMANCE ===
# Redis removed - using Firestore hybrid cache system (Phases 2-4)
cachetools>=5.3.2

# === MONITORING & OBSERVABILITY ===
# System monitoring
psutil==7.0.0

# Google Cloud Operations Suite
google-cloud-monitoring==2.27.2
google-cloud-logging==3.10.0
google-cloud-storage>=2.10.0

# Structured logging
python-json-logger>=2.0.7

# === TEXT PROCESSING ===
nltk==3.9.1

# === MULTIMODAL PROCESSING ===
# Computer vision and OCR
opencv-python==4.10.0.84
Pillow==10.4.0
pytesseract==0.3.10
easyocr==1.7.1  # NOTE: Check compatibility with torch==2.8.0
scipy==1.14.0

# File handling and validation
python-magic==0.4.27

# === DATABASE & VECTOR STORE ===
# Supabase integration - FASE 3 RAG
supabase==2.18.1
psycopg2-binary==2.9.9  # PostgreSQL adapter with pgvector support

# Optional SQL support
sqlalchemy>=2.0.0
alembic>=1.12.0

# Lightweight vector store fallback
faiss-cpu>=1.7.4

# === UTILITIES ===
python-dotenv==1.1.1
typing-extensions>=4.11.0
setuptools==78.1.1
python-dateutil>=2.8.2

# Configuration management
pyyaml>=6.0.1
python-decouple>=3.8

# === TESTING & QUALITY ASSURANCE ===
pytest==7.4.3
pytest-cov==4.1.0
pytest-mock==3.12.0

# === SECURITY ANALYSIS & COMPLIANCE ===
# Vulnerability scanning
safety>=2.3.0
pip-audit>=2.6.0

# Static analysis
bandit>=1.7.5
semgrep>=1.45.0
pylint>=2.17.0
flake8>=6.0.0
mypy>=1.5.0

# === DOCUMENTATION ===
# API documentation
flask-swagger-ui>=4.11.1

# Sphinx documentation
sphinx>=7.1.0
sphinx-rtd-theme>=1.3.0

# === ASYNC & WEBSOCKETS ===
asyncio>=3.4.3
websockets>=11.0.0

# === BACKGROUND TASKS ===
celery==5.3.4  # Base celery without Redis dependency

# === PERFORMANCE MONITORING ===
py-spy>=0.3.14

# === GEOLOCATION (OPTIONAL) ===
geoip2>=4.7.0

# ============================================================================
# SECURITY UPDATE NOTES - September 25, 2025:
#
# CRITICAL VULNERABILITIES ADDRESSED:
# ‚úì CVE-2025-59420: authlib 1.6.3 ‚Üí 1.6.4 (JWT/JWS critical header bypass)
# ‚úì CVE-2025-3730: torch 2.7.1 ‚Üí 2.8.0 (ctc_loss DoS vulnerability)
# ‚úì CVE-2024-47874: starlette 0.47.2 ‚Üí 0.40.0 (Multipart DoS)
# ‚úì MAINTENANCE: numpy 1.26.4 ‚Üí 2.3.3 (latest stable - TEST COMPATIBILITY)
# ‚úì MAINTENANCE: fastapi 0.116.1 ‚Üí 0.118.6 (latest secure)
#
# BREAKING CHANGES POSSIBLE:
# ‚ö†Ô∏è  numpy: 2.x introduces breaking changes - test thoroughly
# ‚ö†Ô∏è  starlette: Major version changes may affect middleware
# ‚ö†Ô∏è  fastapi: API changes possible - test endpoints
# ‚ö†Ô∏è  torch: Minor API changes possible - test ML pipeline
#
# MEDICAL SYSTEM SAFETY:
# üè• JWT vulnerability fix CRITICAL for medical data access control
# üè• DoS vulnerabilities fix CRITICAL for system availability
# üè• All updates must maintain medication calculation accuracy
# üè• Comprehensive testing required before production deployment
#
# ROLLBACK PLAN:
# If any package breaks functionality, revert to previous version:
# - authlib==1.6.3 (if JWT issues - apply manual security measures)
# - torch==2.7.1 (if ML pipeline breaks - investigate alternatives)
# - numpy==1.26.4 (if mathematical operations fail)
# - Previous FastAPI/Starlette versions (if API breaks)
#
# TESTING PRIORITY:
# 1. CRITICAL: Authentication system (JWT tokens, user access)
# 2. CRITICAL: AI personas (Dr. Gasnelio, G√° responses)
# 3. CRITICAL: Medical calculations and data accuracy
# 4. HIGH: API endpoints and CORS functionality
# 5. HIGH: ML pipeline and RAG system
# 6. MEDIUM: Performance and memory usage
#
# DEPLOYMENT STRATEGY:
# 1. Test in isolated environment first
# 2. Backup current system completely
# 3. Deploy during maintenance window
# 4. Monitor for 24 hours post-deployment
# 5. Rollback immediately if critical issues detected
# ============================================================================