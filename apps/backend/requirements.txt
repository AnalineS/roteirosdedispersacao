# ============================================================================
# REQUIREMENTS CONSOLIDADO - Sistema Educacional Hanseníase
# Arquivo único com todas as dependências organizadas por categoria
# Inclui dependências de segurança, produção e desenvolvimento
# ============================================================================

# === CORE FLASK ===
# SECURITY: CRITICAL - Updated 2024-09-24 - Latest Flask security patches
Flask==3.1.2
Flask-CORS==6.0.2  # SECURITY UPDATE: CVE-2024-6221, CVE-2024-6839, CVE-2024-6844, CVE-2024-6866
Werkzeug==3.1.4
gunicorn==23.0.0   # SECURITY: Updated 2024-09-24 - CVE-2024-6827 fixed

# === AI & ML CORE ===
# Updated to latest secure version
openai>=1.50.0
sentence-transformers==5.2.0
chromadb>=0.4.0
numpy==2.3.5
scikit-learn==1.8.0

# === AUTHENTICATION & JWT ===
# CRITICAL SECURITY FIX: JWT vulnerability
authlib==1.6.6     # SECURITY UPDATE: CVE-2025-59420 fix - JWT/JWS critical header vulnerability
PyJWT==2.10.1      # SECURITY: Latest secure version
cryptography==46.0.3  # SECURITY: CRITICAL - Updated 2024-09-24 - Latest security patches
passlib>=1.7.4     # Password hashing

# === SECURITY FRAMEWORK ===
# Rate limiting and middleware security
Flask-Limiter>=3.0.0
limits>=3.6.0

# Input validation and sanitization
bleach==6.3.0      # SECURITY: Latest secure version  
email-validator>=2.0.0
validators>=0.22.0
defusedxml==0.7.1
markupsafe==3.0.3

# Secrets management
pynacl>=1.5.0

# User agent analysis and IP validation
user-agents>=2.2.0
ipaddress>=1.0.23

# === VALIDATION & DATA ===
pydantic==2.12.5   # SECURITY: Updated 2024-09-24 - Performance improvements and security patches
jsonschema>=4.23.0

# === HTTP & NETWORKING ===
requests==2.32.5   # SECURITY: Updated beyond CVE-2023-32681
httpx>=0.24.0
urllib3>=1.26.0
certifi==2025.11.12

# === CACHE & PERFORMANCE ===
# Hybrid cache: cachetools (memory) + Google Cloud Storage + SQLite fallback
cachetools>=5.3.2

# === MONITORING & OBSERVABILITY ===
# System monitoring
psutil==5.9.8

# Google Cloud Operations Suite
google-cloud-monitoring==2.28.0
# google-cloud-logging MANTIDO em 3.10.0 devido a conflito de dependências
# PROBLEMA: Versões 3.11.x+ requerem opentelemetry-api>=1.9.0 que conflita com semgrep
#   - semgrep>=1.113.0 requer opentelemetry-api~=1.25.0 (versão específica)
#   - semgrep>=1.137.0 requer opentelemetry-api~=1.37.0 (versão específica)
#   - Resultado: pip entra em loop "resolution-too-deep" testando centenas de combinações
# ANÁLISE REALIZADA:
#   - Python 3.11.13 é versão ideal (upgrade não resolve o conflito)
#   - Testado upgrade incremental 3.10.0→3.11.4: FALHOU (mesmo erro)
#   - Opções analisadas: manter 3.10.0 (ZERO risco) vs pins complexos (MÉDIO risco)
# SEGURANÇA: 3.10.0 sem vulnerabilidades conhecidas (verificado 2025-10-07)
# REVISÃO: 2025-04 (verificar se conflito foi resolvido upstream)
# ALTERNATIVAS: Ver apps/backend/python_version_analysis.py para opções de upgrade
google-cloud-logging==3.12.1
google-cloud-storage>=2.10.0

# Structured logging
python-json-logger>=2.0.7

# === TEXT PROCESSING ===
nltk==3.9.2

# === MULTIMODAL PROCESSING ===
# Computer vision and OCR
opencv-python==4.12.0.88
Pillow==10.4.0
pytesseract==0.3.13
easyocr==1.7.2  # NOTE: Contains torch@2.8.0 with known vulnerabilities pending upstream fix
scipy==1.16.3

# File handling and validation  
python-magic==0.4.27

# === DATABASE & VECTOR STORE ===
# Supabase integration - FASE 3 RAG
supabase==2.25.1
psycopg2-binary==2.9.11  # PostgreSQL adapter with pgvector support

# Optional SQL support
sqlalchemy>=2.0.0
# Database migrations (evaluate if needed - minimal current usage)
alembic>=1.12.0

# Lightweight vector store fallback
faiss-cpu>=1.7.4

# AstraDB migration - DEPRECATED in FASE 3
# astrapy==2.0.1  # Removed - using Supabase pgvector
# cassandra-driver>=3.29.1  # Removed - heavy dependency

# === UTILITIES ===
python-dotenv==1.2.1
typing-extensions>=4.11.0
setuptools==78.1.1
python-dateutil>=2.8.2

# Configuration management
pyyaml>=6.0.1
python-decouple>=3.8

# === TESTING & QUALITY ASSURANCE ===
pytest==7.4.4  # Updated for pytest 8.x migration (FASE 0 completion)
pytest-cov==6.0.0  # Compatible with pytest 8.x
pytest-mock==3.15.1

# === SECURITY ANALYSIS & COMPLIANCE ===
# Vulnerability scanning
safety>=2.3.0
pip-audit>=2.6.0

# Static analysis
bandit>=1.7.5
semgrep>=1.45.0
pylint>=2.17.0
flake8>=6.0.0
mypy>=1.5.0

# === DOCUMENTATION ===
# API documentation (minimal usage - could be dev-only)
flask-swagger-ui>=4.11.1

# Sphinx documentation - REMOVED (minimal usage in production)
# sphinx>=7.1.0
# sphinx-rtd-theme>=1.3.0

# === ASYNC & WEBSOCKETS ===
asyncio>=3.4.3
websockets>=11.0.0

# === BACKGROUND TASKS ===
# ESSENTIAL for async medical processing - DO NOT REMOVE
# Used in: tasks/ (chat_tasks.py, medical_tasks.py, analytics_tasks.py)
# Purpose: Async processing of medical consultations, chat responses, analytics
celery==5.6.0  # SECURITY: Critical asyncio fix for Python 3.13, improved task management

# === PERFORMANCE MONITORING ===
py-spy>=0.3.14

# === GEOLOCATION (OPTIONAL) ===
geoip2>=4.7.0

# ============================================================================
# DEPLOYMENT NOTES:
#
# 1. SECURITY UPDATES APPLIED:
#    ✓ Flask-CORS: 4.0.0 -> 6.0.0 (CVE fixes)
#    ✓ Cryptography: Latest secure version  
#    ✓ Gunicorn: CVE-2024-6827 fixed
#    ✓ Requests: CVE-2023-32681 patched
#
# 2. COMPATIBILITY:
#    ✓ All packages tested with Python 3.13
#    ✓ Backward compatibility maintained
#    ✓ No breaking changes identified
#
# 3. PERFORMANCE:
#    ✓ Optimized for Cloud Run deployment
#    ✓ Estimated build time: ~8-10 minutes
#    ✓ Container size: ~800MB
#
# 4. CONSOLIDATED FROM:
#    - requirements.txt (main dependencies)
#    - requirements_production.txt (production optimizations)  
#    - core/security/requirements_security.txt (security packages)
# ============================================================================
starlette>=0.49.1 # not directly required, pinned by Snyk to avoid a vulnerability
zipp>=3.19.1 # not directly required, pinned by Snyk to avoid a vulnerability
marshmallow>=3.26.2 # not directly required, pinned by Snyk to avoid a vulnerability
torch>=2.2.0 # not directly required, pinned by Snyk to avoid a vulnerability