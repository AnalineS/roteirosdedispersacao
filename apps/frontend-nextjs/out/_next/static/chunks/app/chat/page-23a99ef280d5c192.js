(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{1340:function(e,a,t){Promise.resolve().then(t.bind(t,9624))},9624:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return H}});var s=t(7437),r=t(29),n=t.n(r),o=t(2265),i=t(7648),c=t(4768),l=t(319),d=t(5121);function u(e){let{personas:a,selectedPersona:t,onPersonaChange:r,isMobile:i=!1}=e,[c,u]=(0,o.useState)(null),m=Object.entries(a),p=t?m.findIndex(e=>{let[a]=e;return a===t}):-1,f=e=>{r(e)};return 0===m.length?null:(0,s.jsxs)("div",{style:{position:"relative"},className:"jsx-f222b2bdeaf6e1d",children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",background:"rgba(255,255,255,0.1)",borderRadius:"20px",padding:i?"4px":"6px",border:"1px solid rgba(255,255,255,0.2)",gap:"4px",minWidth:i?"200px":"280px"},className:"jsx-f222b2bdeaf6e1d",children:[(0,s.jsx)("button",{onClick:()=>{if(0===m.length)return;let e=p<=0?m.length-1:p-1,[a]=m[e];r(a)},disabled:m.length<=1,style:{background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"50%",width:i?"32px":"36px",height:i?"32px":"36px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",cursor:m.length>1?"pointer":"not-allowed",fontSize:i?"0.8rem":"0.9rem",opacity:m.length>1?1:.5,transition:"all 0.2s ease"},onMouseEnter:e=>{m.length>1&&(e.currentTarget.style.background="rgba(255,255,255,0.25)",e.currentTarget.style.transform="scale(1.05)")},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255,255,255,0.15)",e.currentTarget.style.transform="scale(1)"},title:m.length>1?"Assistente anterior":"Apenas um assistente dispon\xedvel",className:"jsx-f222b2bdeaf6e1d",children:"‹"}),(0,s.jsxs)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",minHeight:i?"40px":"44px",overflow:"hidden"},className:"jsx-f222b2bdeaf6e1d",children:[(0,s.jsx)("div",{style:{display:"flex",alignItems:"center",gap:i?"6px":"8px",position:"relative"},className:"jsx-f222b2bdeaf6e1d",children:m.map((e,a)=>{let[r,n]=e,o=t===r,h=1>=Math.abs(a-p)||0===p&&a===m.length-1||p===m.length-1&&0===a;return i&&!o&&!h&&m.length>3?null:(0,s.jsxs)("div",{style:{position:"relative",transition:"all 0.3s ease",transform:o?"scale(1.1)":"scale(0.9)",opacity:o?1:.6},onMouseEnter:()=>u(r),onMouseLeave:()=>u(null),className:"jsx-f222b2bdeaf6e1d",children:[(0,s.jsx)("button",{onClick:()=>f(r),style:{background:"transparent",border:o?"2px solid ".concat(d.rS.colors.secondary[400]):"2px solid transparent",borderRadius:"50%",padding:"2px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s ease",boxShadow:o?"0 0 12px ".concat(d.rS.colors.secondary[400],"40"):"none"},onMouseEnter:e=>{o||(e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.opacity="0.8")},onMouseLeave:e=>{o||(e.currentTarget.style.transform="scale(1)",e.currentTarget.style.opacity="0.6")},className:"jsx-f222b2bdeaf6e1d",children:(0,s.jsx)(l.Z,{persona:n,personaId:r,size:i?"small":"medium"})}),c===r&&(0,s.jsxs)("div",{style:{position:"absolute",bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:"8px",background:"rgba(0,0,0,0.9)",color:"white",padding:"8px 12px",borderRadius:"8px",fontSize:"0.8rem",fontWeight:"500",whiteSpace:"nowrap",zIndex:1e3,boxShadow:"0 4px 12px rgba(0,0,0,0.3)",animation:"tooltipSlide 0.2s ease"},className:"jsx-f222b2bdeaf6e1d",children:[n.name,(0,s.jsx)("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:"0",height:"0",borderLeft:"4px solid transparent",borderRight:"4px solid transparent",borderTop:"4px solid rgba(0,0,0,0.9)"},className:"jsx-f222b2bdeaf6e1d"})]})]},r)})}),m.length>1&&(0,s.jsx)("div",{style:{position:"absolute",bottom:"-2px",left:"50%",transform:"translateX(-50%)",display:"flex",gap:"3px"},className:"jsx-f222b2bdeaf6e1d",children:m.map((e,a)=>(0,s.jsx)("div",{style:{width:"4px",height:"4px",borderRadius:"50%",background:a===p?d.rS.colors.secondary[400]:"rgba(255,255,255,0.3)",transition:"all 0.3s ease"},className:"jsx-f222b2bdeaf6e1d"},a))})]}),(0,s.jsx)("button",{onClick:()=>{if(0===m.length)return;let e=p>=m.length-1?0:p+1,[a]=m[e];r(a)},disabled:m.length<=1,style:{background:"rgba(255,255,255,0.15)",border:"none",borderRadius:"50%",width:i?"32px":"36px",height:i?"32px":"36px",display:"flex",alignItems:"center",justifyContent:"center",color:"white",cursor:m.length>1?"pointer":"not-allowed",fontSize:i?"0.8rem":"0.9rem",opacity:m.length>1?1:.5,transition:"all 0.2s ease"},onMouseEnter:e=>{m.length>1&&(e.currentTarget.style.background="rgba(255,255,255,0.25)",e.currentTarget.style.transform="scale(1.05)")},onMouseLeave:e=>{e.currentTarget.style.background="rgba(255,255,255,0.15)",e.currentTarget.style.transform="scale(1)"},title:m.length>1?"Pr\xf3ximo assistente":"Apenas um assistente dispon\xedvel",className:"jsx-f222b2bdeaf6e1d",children:"›"})]}),t&&a[t]&&(0,s.jsx)("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"4px",fontSize:i?"0.7rem":"0.75rem",color:"rgba(255,255,255,0.9)",fontWeight:"500",textAlign:"center",whiteSpace:"nowrap"},className:"jsx-f222b2bdeaf6e1d",children:a[t].name}),(0,s.jsx)(n(),{id:"f222b2bdeaf6e1d",children:"@-webkit-keyframes tooltipSlide{from{opacity:0;-webkit-transform:translatex(-50%)translatey(4px);transform:translatex(-50%)translatey(4px)}to{opacity:1;-webkit-transform:translatex(-50%)translatey(0);transform:translatex(-50%)translatey(0)}}@-moz-keyframes tooltipSlide{from{opacity:0;-moz-transform:translatex(-50%)translatey(4px);transform:translatex(-50%)translatey(4px)}to{opacity:1;-moz-transform:translatex(-50%)translatey(0);transform:translatex(-50%)translatey(0)}}@-o-keyframes tooltipSlide{from{opacity:0;-o-transform:translatex(-50%)translatey(4px);transform:translatex(-50%)translatey(4px)}to{opacity:1;-o-transform:translatex(-50%)translatey(0);transform:translatex(-50%)translatey(0)}}@keyframes tooltipSlide{from{opacity:0;-webkit-transform:translatex(-50%)translatey(4px);-moz-transform:translatex(-50%)translatey(4px);-o-transform:translatex(-50%)translatey(4px);transform:translatex(-50%)translatey(4px)}to{opacity:1;-webkit-transform:translatex(-50%)translatey(0);-moz-transform:translatex(-50%)translatey(0);-o-transform:translatex(-50%)translatey(0);transform:translatex(-50%)translatey(0)}}"})]})}var m=t(2983),p=t(8223),f=t(6830);class h{async searchContext(e){let a=Date.now(),t=this.generateCacheKey(e),s=this.getCachedResponse(t);if(s)return{...s,cached:!0,processing_time:Date.now()-a};try{let s=await this.simulateRAGResponse(e);return this.cacheResponse(t,s),{...s,cached:!1,processing_time:Date.now()-a}}catch(a){return console.error("Erro ao buscar contexto ASTRA:",a),this.localFallbackSearch(e)}}async sendFeedback(e){try{console.log("Feedback registrado:",e),await new Promise(e=>setTimeout(e,500))}catch(e){console.error("Erro ao enviar feedback:",e)}}async getStats(){try{return{cache_stats:{total_cached_responses:this.cache.size,cache_hits:45,cache_misses:15,hit_rate_percent:75},feedback_stats:{total_feedback:120,average_rating:4.2,rating_distribution:{1:5,2:10,3:20,4:50,5:35}},system_stats:{total_chunks:250,knowledge_base_size:5242880}}}catch(e){throw console.error("Erro ao obter estat\xedsticas:",e),e}}async simulateRAGResponse(e){await new Promise(e=>setTimeout(e,300));let a=e.question.toLowerCase(),t=[{content:"A Poliquimioterapia \xdanica (PQT-U) \xe9 o esquema padr\xe3o para tratamento da hansen\xedase, consistindo em rifampicina 600mg dose mensal supervisionada, clofazimina 300mg dose mensal supervisionada e 50mg di\xe1ria autoadministrada, e dapsona 100mg di\xe1ria autoadministrada.",section:"tratamento_pqtu",topics:["pqt-u","poliquimioterapia","dosagem","rifampicina","clofazimina","dapsona"]},{content:"A rifampicina pode causar colora\xe7\xe3o avermelhada na urina, suor e l\xe1grimas nas primeiras 48 horas ap\xf3s a dose, sendo um efeito esperado e n\xe3o prejudicial. Pacientes devem ser orientados para n\xe3o se alarmarem.",section:"efeitos_adversos_rifampicina",topics:["rifampicina","efeito adverso","colora\xe7\xe3o","urina"]},{content:"A clofazimina pode causar hiperpigmenta\xe7\xe3o cut\xe2nea e ressecamento da pele, que s\xe3o revers\xedveis ap\xf3s o t\xe9rmino do tratamento. O uso de hidratantes e protetor solar \xe9 recomendado.",section:"efeitos_adversos_clofazimina",topics:["clofazimina","efeito adverso","hiperpigmenta\xe7\xe3o","pele"]},{content:"A dapsona pode causar anemia hemol\xedtica, especialmente em pacientes com defici\xeancia de G6PD. Monitoramento com hemograma \xe9 recomendado no in\xedcio do tratamento.",section:"efeitos_adversos_dapsona",topics:["dapsona","efeito adverso","anemia","g6pd","hemograma"]},{content:"O tratamento da hansen\xedase com PQT-U tem dura\xe7\xe3o de 6 doses mensais supervisionadas. A ades\xe3o ao tratamento \xe9 fundamental para a cura e preven\xe7\xe3o de resist\xeancia medicamentosa.",section:"duracao_tratamento",topics:["tratamento","dura\xe7\xe3o","ades\xe3o","cura"]}].map(e=>{let t=0;e.topics.forEach(e=>{a.includes(e)&&(t+=2)});let s=e.content.toLowerCase().split(/\s+/),r=a.split(/\s+/);return r.forEach(e=>{s.includes(e)&&(t+=1)}),{...e,relevance_score:t/(r.length+e.topics.length),importance_score:.8}}).filter(e=>e.relevance_score>0).sort((e,a)=>a.relevance_score-e.relevance_score).slice(0,e.maxChunks||3),s=t.map(e=>"[".concat(e.section,"] ").concat(e.content)).join("\n\n");return{chunks:t,combined_context:s||"N\xe3o foram encontradas informa\xe7\xf5es espec\xedficas sobre esta pergunta na base de conhecimento.",confidence:t.length>0?Math.min(t[0].relevance_score,1):0,cached:!1,processing_time:0}}localFallbackSearch(e){let a="\n    Informa\xe7\xf5es b\xe1sicas sobre PQT-U para hansen\xedase:\n    - Esquema padr\xe3o com 3 medicamentos\n    - Dura\xe7\xe3o de 6 meses\n    - Doses supervisionadas mensais\n    \n    Para informa\xe7\xf5es mais espec\xedficas, consulte um profissional de sa\xfade.\n    ";return{chunks:[{content:a,section:"fallback",relevance_score:.3,topics:["pqt-u","hanseniase"],importance_score:.5}],combined_context:a,confidence:.3,cached:!1,processing_time:10}}generateCacheKey(e){return"".concat(e.question,"_").concat(e.persona||"default","_").concat(e.maxChunks||3).toLowerCase().replace(/\s+/g,"_")}getCachedResponse(e){let a=this.cache.get(e);return a?Date.now()-(a.processing_time||0)>this.cacheTimeout?(this.cache.delete(e),null):a:null}cacheResponse(e,a){if(this.cache.size>100){let e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(e,a)}clearCache(){this.cache.clear()}constructor(){this.cacheTimeout=3e5,this.baseUrl="https://roteiro-dispensacao-api-1016586236354.us-central1.run.app",this.cache=new Map}}let g=new h;class y{static getInstance(){return y.instance||(y.instance=new y),y.instance}async searchKnowledge(e,a,t,s){let r=this.adjustSearchBySentiment(a,s),n={question:e,persona:t,maxChunks:r.maxChunks,...a&&{sentiment:{category:a.category,score:a.score,magnitude:a.magnitude}}},o=await g.searchContext(n);return r.minConfidence&&o.confidence<r.minConfidence?this.getFallbackResponse(e,t):o}async enrichMessage(e,a,t){try{let s=await this.searchKnowledge(e,a,t,{maxChunks:2,minConfidence:.5});if(!s.combined_context||s.confidence<.3)return{original:e,enriched:e,confidence:0,sources:[]};let r=this.buildEnrichedMessage(e,s,a);return{original:e,enriched:r.text,context:s.combined_context,confidence:s.confidence,sources:r.sources}}catch(a){return console.error("Erro ao enriquecer mensagem:",a),{original:e,enriched:e,confidence:0,sources:[]}}}adjustSearchBySentiment(e,a){let t={maxChunks:3,includeContext:!0,filterByTopics:[],minConfidence:.3};if(!e)return{...t,...a};switch(e.category){case f.XI.ANXIOUS:return{...t,...a,maxChunks:4,minConfidence:.5};case f.XI.FRUSTRATED:return{...t,...a,maxChunks:2,minConfidence:.6};case f.XI.CONCERNED:return{...t,...a,maxChunks:5,includeContext:!0};default:return{...t,...a}}}buildEnrichedMessage(e,a,t){let s=[],r=e,n=a.chunks[0];return n&&n.relevance_score>.7&&(s.push(n.section),r=(null==t?void 0:t.category)===f.XI.ANXIOUS?"Entendo sua preocupa\xe7\xe3o. ".concat(e,"\n\nInforma\xe7\xe3o importante: ").concat(this.simplifyContent(n.content)):(null==t?void 0:t.category)===f.XI.FRUSTRATED?"".concat(e,"\n\nResumo: ").concat(this.extractKeyPoints(n.content)):"".concat(e,"\n\nContexto adicional: ").concat(n.content)),a.chunks.slice(1).forEach(e=>{e.relevance_score>.5&&s.push(e.section)}),{text:r,sources:s}}simplifyContent(e){let a=e;return[{from:/poliquimioterapia única|PQT-U/gi,to:"tratamento combinado"},{from:/hiperpigmentação/gi,to:"escurecimento da pele"},{from:/anemia hemolítica/gi,to:"redu\xe7\xe3o de gl\xf3bulos vermelhos"},{from:/dose supervisionada/gi,to:"dose tomada na presen\xe7a do profissional"}].forEach(e=>{let{from:t,to:s}=e;a=a.replace(t,s)}),a.length>200&&(a=a.substring(0,197)+"..."),a}extractKeyPoints(e){let a=e.split(/[.!?]+/),t=[];return a.forEach(e=>{(/\d+\s*(mg|ml|dose|mês|meses|dia|dias)/i.test(e)||/deve|precisa|importante|necessário/i.test(e))&&t.push(e.trim())}),t.slice(0,3).join(". ")+"."}getFallbackResponse(e,a){let t="ga"===a?"N\xe3o encontrei informa\xe7\xf5es espec\xedficas sobre isso, mas posso ajudar de outras formas. O que mais voc\xea gostaria de saber?":"N\xe3o h\xe1 informa\xe7\xf5es detalhadas sobre este t\xf3pico na base de conhecimento atual. Recomendo consultar as diretrizes oficiais ou um especialista.";return{chunks:[{content:t,section:"fallback",relevance_score:0,topics:[],importance_score:0}],combined_context:t,confidence:0,cached:!1,processing_time:0}}async prefetchCommonTopics(){await Promise.all(["Como funciona o tratamento PQT-U?","Quais s\xe3o os efeitos colaterais?","Quanto tempo dura o tratamento?","Posso tomar os rem\xe9dios em casa?"].map(e=>this.searchKnowledge(e,void 0,void 0,{maxChunks:2}).catch(e=>console.error("Erro no prefetch:",e))))}constructor(){}}let b=y.getInstance();class x{static getInstance(){return x.instance||(x.instance=new x),x.instance}async executeFallback(e,a,t){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{useLocalKnowledge:r=!0,includeEmergencyContacts:n=!0,adaptToSentiment:o=!0,maxRetries:i=3,timeoutMs:c=5e3}=s;switch(this.recordFailure(),a){case"network":case"timeout":return this.handleNetworkFallback(e,t,s);case"server_error":return this.handleServerErrorFallback(e,t,s);case"data_corruption":return this.handleDataCorruptionFallback(e,t,s);default:return this.handleGenericFallback(e,t,s)}}async handleNetworkFallback(e,a){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let t=this.searchLocalCache(e);if(t)return{success:!0,response:this.adaptResponseToSentiment(t,a),source:"cache",confidence:.8,suggestion:"Resposta baseada em cache local. Conex\xe3o pode estar inst\xe1vel."};let s=this.searchLocalKnowledge(e);return s?{success:!0,response:this.adaptResponseToSentiment(s,a),source:"local_knowledge",confidence:.6,suggestion:"Resposta baseada em conhecimento local. Recomendo tentar novamente quando a conex\xe3o melhorar."}:this.getEmergencyResponse(e,"network",a)}async handleServerErrorFallback(e,a){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let t=this.searchLocalKnowledge(e);return t?{success:!0,response:this.adaptResponseToSentiment(t,a),source:"local_knowledge",confidence:.7,suggestion:"Sistema principal temporariamente indispon\xedvel. Resposta baseada em conhecimento local."}:this.getEmergencyResponse(e,"server_error",a)}async handleDataCorruptionFallback(e,a){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let t=this.searchLocalKnowledge(e);return t?{success:!0,response:this.adaptResponseToSentiment(t,a),source:"local_knowledge",confidence:.6,suggestion:"Detectado problema nos dados. Usando conhecimento local verificado."}:this.getEmergencyResponse(e,"data_corruption",a)}async handleGenericFallback(e,a){return arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.getEmergencyResponse(e,"unknown",a)}searchLocalCache(e){let a=e.toLowerCase().trim();for(let e of[{key:"rifampicina dose",response:"A rifampicina \xe9 administrada na dose de 600mg uma vez por m\xeas, sempre sob supervis\xe3o profissional."},{key:"clofazimina efeito",response:"A clofazimina pode causar hiperpigmenta\xe7\xe3o da pele, que \xe9 revers\xedvel ap\xf3s o tratamento."},{key:"dapsona dose",response:"A dapsona \xe9 administrada na dose de 100mg diariamente por via oral."},{key:"tratamento dura\xe7\xe3o",response:"O tratamento PQT-U tem dura\xe7\xe3o de 6 doses mensais supervisionadas."}])if(a.includes(e.key.split(" ")[0])&&a.includes(e.key.split(" ")[1]))return e.response;return null}searchLocalKnowledge(e){let a=e.toLowerCase();for(let e of[{keywords:["rifampin","dose","quantidade"],response:"A rifampicina \xe9 o medicamento principal do esquema PQT-U, administrada mensalmente sob supervis\xe3o. Para informa\xe7\xf5es espec\xedficas de dosagem, consulte um profissional de sa\xfade."},{keywords:["clofazimin","pele","cor","escura"],response:"A clofazimina pode causar escurecimento tempor\xe1rio da pele. Este efeito \xe9 normal e revers\xedvel. Continue o tratamento conforme orienta\xe7\xe3o m\xe9dica."},{keywords:["dapsona","di\xe1rio","casa"],response:"A dapsona \xe9 tomada diariamente em casa. \xc9 importante n\xe3o interromper o uso sem orienta\xe7\xe3o m\xe9dica."},{keywords:["efeito","colateral","adverso","rea\xe7\xe3o"],response:"Efeitos adversos podem ocorrer durante o tratamento. Os mais comuns s\xe3o colora\xe7\xe3o da urina (rifampicina) e escurecimento da pele (clofazimina). Procure orienta\xe7\xe3o m\xe9dica se tiver d\xfavidas."},{keywords:["tempo","dura\xe7\xe3o","quanto","meses"],response:"O tratamento PQT-U dura 6 meses, com doses mensais supervisionadas. \xc9 fundamental completar todo o tratamento para garantir a cura."},{keywords:["gravidez","gestante","gr\xe1vida"],response:"O tratamento para hansen\xedase pode ser realizado durante a gravidez com adapta\xe7\xf5es. \xc9 essencial acompanhamento m\xe9dico especializado."}])if(e.keywords.some(e=>a.includes(e)))return e.response;return null}getEmergencyResponse(e,a,t){let s="",r="";return(null==t?void 0:t.category)===f.XI.ANXIOUS?(s="Compreendo sua preocupa\xe7\xe3o. Embora eu n\xe3o possa acessar todas as informa\xe7\xf5es no momento, posso assegurar que o tratamento para hansen\xedase \xe9 seguro e eficaz quando seguido corretamente.",r="Para informa\xe7\xf5es urgentes, procure: Posto de Sa\xfade mais pr\xf3ximo ou ligue 136 (Disque Sa\xfade)"):(null==t?void 0:t.category)===f.XI.FRUSTRATED?(s="Entendo sua frustra\xe7\xe3o. O sistema est\xe1 temporariamente indispon\xedvel, mas posso orientar sobre o b\xe1sico do tratamento PQT-U.",r="Para respostas mais espec\xedficas: Unidade B\xe1sica de Sa\xfade ou Ambulat\xf3rio de Hansen\xedase"):(s="Sistema temporariamente indispon\xedvel. O tratamento para hansen\xedase (PQT-U) \xe9 padronizado e eficaz - continue seguindo as orienta\xe7\xf5es do seu m\xe9dico.",r="Para mais informa\xe7\xf5es: Minist\xe9rio da Sa\xfade - Disque 136"),e.toLowerCase().includes("dose")||e.toLowerCase().includes("quantidade")?s+=" Lembre-se: n\xe3o altere doses sem orienta\xe7\xe3o m\xe9dica.":(e.toLowerCase().includes("efeito")||e.toLowerCase().includes("rea\xe7\xe3o"))&&(s+=" Se apresentar rea\xe7\xf5es adversas intensas, procure atendimento m\xe9dico."),{success:!0,response:s,source:"emergency",confidence:.4,suggestion:"Sistema indispon\xedvel. Recomendo consultar profissional de sa\xfade para informa\xe7\xf5es espec\xedficas.",emergency_contact:r}}adaptResponseToSentiment(e,a){if(!a)return e;switch(a.category){case f.XI.ANXIOUS:return"Entendo sua preocupa\xe7\xe3o. ".concat(e," Lembre-se que voc\xea n\xe3o est\xe1 sozinho(a) neste tratamento.");case f.XI.FRUSTRATED:return"".concat(e," Espero que isso esclare\xe7a sua d\xfavida de forma mais direta.");case f.XI.POSITIVE:return"".concat(e," Fico feliz em poder ajudar!");default:return e}}initializeLocalKnowledge(){["O tratamento PQT-U \xe9 seguro e eficaz quando seguido corretamente","Nunca interrompa o tratamento sem orienta\xe7\xe3o m\xe9dica","Efeitos como colora\xe7\xe3o da urina e escurecimento da pele s\xe3o normais","O tratamento dura 6 meses com doses mensais supervisionadas","A hansen\xedase tem cura quando tratada adequadamente"].forEach((e,a)=>{this.localKnowledge.set("essential_".concat(a),e)})}initializeEmergencyResponses(){this.emergencyResponses.set("network","Conex\xe3o temporariamente indispon\xedvel. Continue seu tratamento normalmente e tente novamente mais tarde."),this.emergencyResponses.set("server_error","Sistema em manuten\xe7\xe3o. Para d\xfavidas urgentes, procure seu posto de sa\xfade."),this.emergencyResponses.set("data_corruption","Problema nos dados detectado. Recomendo consultar profissional de sa\xfade.")}recordFailure(){this.failureCount++,this.lastFailureTime=Date.now()}getFailureStats(){let e=Date.now()-this.lastFailureTime,a="good";return this.failureCount>10&&e<3e5?a="degraded":this.failureCount>20&&(a="critical"),{count:this.failureCount,lastFailure:this.lastFailureTime,systemHealth:a}}resetFailureCount(){this.failureCount=0,this.lastFailureTime=0}constructor(){this.failureCount=0,this.lastFailureTime=0,this.localKnowledge=new Map,this.emergencyResponses=new Map,this.initializeLocalKnowledge(),this.initializeEmergencyResponses()}}let v=x.getInstance();async function w(e,a,t){let s="unknown";return a.message.includes("network")||a.message.includes("fetch")?s="network":a.message.includes("timeout")?s="timeout":a.message.includes("500")||a.message.includes("502")||a.message.includes("503")?s="server_error":(a.message.includes("corrupt")||a.message.includes("invalid"))&&(s="data_corruption"),v.executeFallback(e,s,t)}let k="conversation-history",j={dr_gasnelio:{personaId:"dr_gasnelio",expertiseAreas:["clinical","dosage","protocols","diagnosis","treatment"],keywords:["dose","dosagem","mg","rifampicina","dapsona","clofazimina","protocolo","tratamento","diagn\xf3stico","cl\xednico","m\xe9dico","prescri\xe7\xe3o","posologia","terap\xeautica","PQT-U","PQT","multibacilar","paucibacilar","MB","PB","esquema","rea\xe7\xe3o","efeito colateral","contraindica\xe7\xe3o","intera\xe7\xe3o"],specialties:["Dosagens","Protocolos Cl\xednicos","Diagn\xf3stico"]},ga:{personaId:"ga",expertiseAreas:["education","dispensation","family","guidance","support"],keywords:["paciente","fam\xedlia","educa\xe7\xe3o","orienta\xe7\xe3o","ensino","dispensa\xe7\xe3o","farm\xe1cia","entrega","cronograma","organiza\xe7\xe3o","ader\xeancia","ades\xe3o","motiva\xe7\xe3o","apoio","comunica\xe7\xe3o","explicar","ensinar","orientar","acompanhar","conversar","d\xfavidas","medo","preconceito","estigma","social"],specialties:["Educa\xe7\xe3o do Paciente","Dispensa\xe7\xe3o","Apoio Familiar"]}};class S{set(e,a){let t=this.normalizeQuestion(e);this.cache.set(t,{analysis:a,timestamp:Date.now()}),this.cleanupExpired()}get(e){let a=this.normalizeQuestion(e),t=this.cache.get(a);return t&&Date.now()-t.timestamp<this.TTL?t.analysis:(t&&this.cache.delete(a),null)}normalizeQuestion(e){return e.toLowerCase().replace(/[^\w\s]/g,"").replace(/\s+/g," ").trim()}cleanupExpired(){let e=Date.now();Array.from(this.cache.entries()).forEach(a=>{let[t,s]=a;e-s.timestamp>=this.TTL&&this.cache.delete(t)})}constructor(){this.cache=new Map,this.TTL=3e5}}let C=new S;async function E(e,a){try{let t=C.get(e);if(t)return t;let s=A(e,a),r=null;try{r=await (0,p.$N)(e)}catch(e){console.warn("Backend scope detection failed, using local analysis:",e)}let n=function(e,a,t){if(!a||!a.recommended_persona)return e;let s=a.recommended_persona;if(t[s]){let t=a.confidence||.5,r=(e.confidence+t)/2;if(s===e.recommendedPersonaId)return{...e,confidence:Math.min(.95,r+.2),reasoning:"".concat(e.reasoning," (confirmado por IA)")};if(t>e.confidence)return{recommendedPersonaId:s,confidence:r,reasoning:a.reasoning||"Recomendado por an\xe1lise de IA",scope:a.scope||e.scope,alternatives:[{personaId:e.recommendedPersonaId,confidence:e.confidence,reasoning:e.reasoning},...e.alternatives]}}return e}(s,r,a);return C.set(e,n),n}catch(t){return console.error("Erro na an\xe1lise de roteamento:",t),A(e,a)}}function A(e,a){var t;let s=e.toLowerCase(),r={},n={};Object.keys(a).forEach(e=>{let a=j[e];if(!a)return;let t=0,o=[];a.keywords.forEach(e=>{s.includes(e.toLowerCase())&&(t+=e.length>6?2:1,o.push(e))}),a.expertiseAreas.forEach(e=>{s.includes(e)&&(t+=3,o.push(e))}),r[e]=t,n[e]=o});let o=Object.entries(r).sort((e,a)=>{let[,t]=e,[,s]=a;return s-t}).filter(e=>{let[,a]=e;return a>0});if(0===o.length){let e="dr_gasnelio";return{recommendedPersonaId:e,confidence:.3,reasoning:"Quest\xe3o geral - roteado para especialista cl\xednico",scope:"general",alternatives:Object.keys(a).filter(a=>a!==e).map(e=>({personaId:e,confidence:.2,reasoning:"Alternativa dispon\xedvel"}))}}let[i,c]=o[0],l=(null===(t=j[i])||void 0===t?void 0:t.keywords.length)||1,d=n[i]||[];return{recommendedPersonaId:i,confidence:Math.min(.95,c/l*.8+.2),reasoning:d.length>0?"Especialista em: ".concat(d.slice(0,3).join(", ")):"Melhor correspond\xeancia de expertise",scope:["dose","dosagem","mg","quantidade","posologia"].some(e=>s.includes(e))?"dosage":["diagn\xf3stico","sintoma","caso","tratamento","protocolo"].some(e=>s.includes(e))?"clinical":["paciente","fam\xedlia","explicar","ensinar","orientar"].some(e=>s.includes(e))?"education":["dispensar","farm\xe1cia","entrega","cronograma"].some(e=>s.includes(e))?"dispensation":"general",alternatives:o.slice(1,3).map(e=>{var a;let[t,s]=e;return{personaId:t,confidence:Math.min(.8,s/l*.6+.1),reasoning:(null===(a=n[t])||void 0===a?void 0:a.length)>0?"Tamb\xe9m especialista em: ".concat(n[t].slice(0,2).join(", ")):"Alternativa com expertise relacionada"}})}}var z=t(8497);let T=e=>{let{size:a="medium",color:t=d.rS.colors.primary[500],message:r,inline:o=!1}=e,i={small:"16px",medium:"24px",large:"32px"},c={display:o?"inline-flex":"flex",alignItems:"center",justifyContent:"center",gap:"8px",...!o&&{minHeight:"40px",padding:"8px"}},l={width:i[a],height:i[a],border:"2px solid ".concat(t,"20"),borderTop:"2px solid ".concat(t),borderRadius:"50%",animation:"spin 1s linear infinite"};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n(),{id:"d732791046adfab6",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"}),(0,s.jsxs)("div",{style:c,className:"jsx-d732791046adfab6",children:[(0,s.jsx)("div",{style:l,className:"jsx-d732791046adfab6"}),r&&(0,s.jsx)("span",{style:{fontSize:"0.9rem",color:d.rS.colors.neutral[600],fontWeight:500},className:"jsx-d732791046adfab6",children:r})]})]})},I=e=>{let{message:a="Carregando..."}=e;return(0,s.jsx)(T,{size:"small",message:a,inline:!0})},R=()=>(0,s.jsx)("div",{style:{padding:"20px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:d.rS.colors.neutral[50],borderRadius:"8px"},children:(0,s.jsx)(T,{size:"medium",message:"Carregando hist\xf3rico..."})}),N=()=>(0,s.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"4px 8px",borderRadius:"12px",backgroundColor:d.rS.colors.neutral[100],border:"1px solid ".concat(d.rS.colors.neutral[200])},children:[(0,s.jsx)(T,{size:"small",inline:!0}),(0,s.jsx)("span",{style:{fontSize:"0.75rem",color:d.rS.colors.neutral[600]},children:"..."})]}),_=(0,o.lazy)(()=>t.e(652).then(t.bind(t,3652))),P=(0,o.lazy)(()=>t.e(610).then(t.bind(t,1610))),D=(0,o.lazy)(()=>t.e(824).then(t.bind(t,824))),M=(0,o.lazy)(()=>t.e(616).then(t.bind(t,1616))),O=(0,o.lazy)(()=>t.e(134).then(t.bind(t,3134)).then(e=>({default:e.SentimentIndicator}))),F=(0,o.lazy)(()=>t.e(247).then(t.bind(t,2247)).then(e=>({default:e.KnowledgeIndicator}))),L=(0,o.lazy)(()=>t.e(538).then(t.bind(t,5538)).then(e=>({default:e.FallbackIndicator}))),q=(0,o.lazy)(()=>t.e(538).then(t.bind(t,5538)).then(e=>({default:e.SystemHealthWarning})));function H(){let{personas:e,loading:a,error:t}=(0,m.H)(),{messages:r,loading:h,error:y,sendMessage:x,currentSentiment:S,personaSwitchSuggestion:C,knowledgeStats:A,lastSearchResult:T,isSearchingKnowledge:H,fallbackState:U,resetFallback:X,resetSystemFailures:K}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{persistToLocalStorage:a=!0,storageKey:t="chat-history",enableSentimentAnalysis:s=!0,enableKnowledgeEnrichment:r=!0}=e,n=(0,o.useCallback)(()=>{if(!a)return[];try{let e=localStorage.getItem(t);return e?JSON.parse(e):[]}catch(e){return console.error("Erro ao carregar hist\xf3rico do chat:",e),[]}},[a,t]),[i,c]=(0,o.useState)(n),[l,d]=(0,o.useState)(!1),[u,m]=(0,o.useState)(null),[h,y]=(0,o.useState)(null),{currentSentiment:x,analyzeSentiment:k,sentimentHistory:j,clearHistory:S}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{debounceMs:a=500,maxHistorySize:t=10,autoAnalyze:s=!0}=e,[r,n]=(0,o.useState)(null),[i,c]=(0,o.useState)([]),[l,d]=(0,o.useState)(!1),u=(0,o.useRef)(null),m=(0,o.useRef)(""),p=(0,o.useCallback)(async e=>{if(!e||e.trim().length<3){let e={score:0,magnitude:0,category:f.XI.NEUTRAL,confidence:0,keywords:[]};return n(e),e}if(e===m.current&&r)return r;d(!0);try{let a=await f.$o.analyze(e);return n(a),m.current=e,c(s=>[{timestamp:Date.now(),text:e.substring(0,100),result:a},...s].slice(0,t)),a}catch(a){console.error("Erro ao analisar sentimento:",a);let e={score:0,magnitude:0,category:f.XI.NEUTRAL,confidence:0,keywords:[]};return n(e),e}finally{d(!1)}},[r,t]);(0,o.useCallback)(e=>{u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{p(e)},a)},[p,a]);let h=(0,o.useCallback)(()=>{c([]),n(null),m.current=""},[]),g=i.length>0?(()=>{let e;let a=i.reduce((e,a)=>e+a.result.score,0)/i.length;return e=a>.2?f.XI.POSITIVE:a<-.4?f.XI.FRUSTRATED:a<-.2?f.XI.ANXIOUS:f.XI.NEUTRAL,{score:a,category:e}})():null;return(0,o.useEffect)(()=>()=>{u.current&&clearTimeout(u.current)},[]),{currentSentiment:r,sentimentHistory:i,analyzeSentiment:p,clearHistory:h,isAnalyzing:l,averageSentiment:g}}({debounceMs:300,autoAnalyze:s}),{searchKnowledge:C,enrichMessage:E,isSearching:A,lastSearchResult:z,stats:T}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{prefetchCommon:a=!0,autoEnrich:t=!0,cacheTimeout:s=3e5}=e,[r,n]=(0,o.useState)(!1),[i,c]=(0,o.useState)(null),[l,d]=(0,o.useState)(null),[u,m]=(0,o.useState)(null),p=(0,o.useRef)(null);(0,o.useEffect)(()=>{a&&b.prefetchCommonTopics().catch(e=>console.error("Erro no prefetch:",e)),x()},[a]);let f=(0,o.useCallback)(async(e,a,t)=>{n(!0),m(null),p.current&&clearTimeout(p.current);try{let s=await b.searchKnowledge(e,a,t,{maxChunks:3,minConfidence:.3});return c(s),console.log("Knowledge search completed:",{question:e.substring(0,50)+"...",confidence:s.confidence,chunks:s.chunks.length,cached:s.cached}),s}catch(a){m(a instanceof Error?a.message:"Erro ao buscar conhecimento"),console.error("Erro na busca de conhecimento:",a);let e={chunks:[],combined_context:"",confidence:0,cached:!1,processing_time:0};return c(e),e}finally{n(!1)}},[]),h=(0,o.useCallback)(async(e,a,s)=>{if(!t)return{original:e,enriched:e,confidence:0,sources:[]};try{return await b.enrichMessage(e,a,s)}catch(a){return console.error("Erro ao enriquecer mensagem:",a),{original:e,enriched:e,confidence:0,sources:[]}}},[t]),y=(0,o.useCallback)(async(e,a,t,s)=>{try{await g.sendFeedback({query:e,response:a,rating:t,comments:s}),setTimeout(()=>x(),1e3)}catch(e){console.error("Erro ao enviar avalia\xe7\xe3o:",e),m("Erro ao enviar avalia\xe7\xe3o")}},[]),x=(0,o.useCallback)(async()=>{try{let e=await g.getStats();d(e)}catch(e){console.error("Erro ao buscar estat\xedsticas:",e)}},[]),v=(0,o.useCallback)(()=>{g.clearCache(),c(null),console.log("Cache de conhecimento limpo")},[]);return(0,o.useEffect)(()=>()=>{p.current&&clearTimeout(p.current)},[]),{isSearching:r,lastSearchResult:i,stats:l,error:u,searchKnowledge:f,enrichMessage:h,rateResponse:y,refreshStats:x,clearCache:v}}({prefetchCommon:!0,autoEnrich:r}),{withFallback:I,shouldUseFallback:R,state:N,reset:_,getSystemStats:P,resetSystemFailures:D}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{maxRetries:a=3,retryDelay:t=1e3,autoReset:s=!0}=e,[r,n]=(0,o.useState)({isActive:!1,result:null,attempts:0,lastFailureType:null,systemHealth:"good"}),i=(0,o.useRef)(),c=(0,o.useCallback)(async(e,a,t)=>{n(e=>({...e,isActive:!0,attempts:e.attempts+1}));try{let r=await w(e,a,t);return n(e=>({...e,result:r,lastFailureType:a.message,systemHealth:v.getFailureStats().systemHealth})),s&&setTimeout(()=>{n(e=>({...e,isActive:!1,result:null}))},5e3),r}catch(a){console.error("Fallback tamb\xe9m falhou:",a);let e={success:!1,response:"Sistema temporariamente indispon\xedvel. Tente novamente em alguns minutos ou consulte um profissional de sa\xfade.",source:"emergency",confidence:.1,emergency_contact:"Disque Sa\xfade: 136"};return n(a=>({...a,result:e,systemHealth:"critical"})),e}},[s]),l=(0,o.useCallback)(async(e,a,t)=>{try{let a=await e();return r.attempts>0&&s&&n(e=>({...e,attempts:0,isActive:!1,result:null})),a}catch(e){return console.warn("Opera\xe7\xe3o falhou, executando fallback:",e),await c(a,e,t)}},[c,r.attempts,s]),d=(0,o.useCallback)(e=>{let a=v.getFailureStats();if("degraded"===a.systemHealth||"critical"===a.systemHealth)return!0;if(e){let a=e.message.toLowerCase();return a.includes("network")||a.includes("timeout")||a.includes("500")||a.includes("502")||a.includes("503")}return!1},[]),u=(0,o.useCallback)(e=>{let a=e.message.toLowerCase();return a.includes("network")?"Verifique sua conex\xe3o com a internet":a.includes("timeout")?"Tente novamente - o servidor pode estar ocupado":a.includes("500")||a.includes("502")||a.includes("503")?"Sistema em manuten\xe7\xe3o - tente novamente em alguns minutos":a.includes("404")?"Recurso n\xe3o encontrado - pode ser um problema tempor\xe1rio":"Erro inesperado - tente novamente ou consulte suporte"},[]),m=(0,o.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{return await e()}catch(n){if(s>=a)throw n;let r=t*Math.pow(2,s-1);return new Promise((a,t)=>{i.current=setTimeout(async()=>{try{let t=await m(e,s+1);a(t)}catch(e){t(e)}},r)})}},[a,t]),p=(0,o.useCallback)(()=>{i.current&&clearTimeout(i.current),n({isActive:!1,result:null,attempts:0,lastFailureType:null,systemHealth:v.getFailureStats().systemHealth})},[]),f=(0,o.useCallback)(()=>v.getFailureStats(),[]),h=(0,o.useCallback)(()=>{v.resetFailureCount(),n(e=>({...e,systemHealth:"good"}))},[]);return{state:r,isActive:r.isActive,result:r.result,attempts:r.attempts,systemHealth:r.systemHealth,executeFallback:c,withFallback:l,shouldUseFallback:d,getFailureSuggestion:u,retryWithBackoff:m,reset:p,getSystemStats:f,resetSystemFailures:h}}({maxRetries:2,retryDelay:1e3,autoReset:!0}),M=(0,o.useRef)(""),O=(0,o.useCallback)(e=>{if(a)try{localStorage.setItem(t,JSON.stringify(e))}catch(e){console.error("Erro ao salvar hist\xf3rico do chat:",e)}},[a,t]);(0,o.useEffect)(()=>{s&&x&&M.current&&((0,f.rn)(x,M.current)?y("dr-gasnelio"===M.current?"ga":"dr-gasnelio"):y(null))},[x,s]);let F=(0,o.useCallback)(async function(e,a){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e.trim())return;let n=null;if(s&&0===t)try{n=await k(e)}catch(e){console.error("Erro na an\xe1lise de sentimento:",e)}let o=null;if(r&&0===t)try{let t=await C(e,n||void 0,a);t.confidence>.3&&t.combined_context&&(o={context:t.combined_context,confidence:t.confidence,sources:t.chunks.map(e=>e.section)})}catch(e){console.error("Erro ao buscar contexto:",e)}M.current=a;let l={role:"user",content:e.trim(),timestamp:Date.now(),persona:a};if(0===t){let e=[...i,l];c(e),O(e)}d(!0),m(null);try{let s=0===t?[...i,l]:i,r={question:e.trim(),personality_id:a,conversation_history:s.slice(-10),...n&&{sentiment:{category:n.category,score:n.score,magnitude:n.magnitude}},...o&&{knowledge_context:o}},u=await I(()=>(0,p.bE)(r),e.trim(),n||void 0);if(u&&"object"==typeof u&&"source"in u){let e={role:"assistant",content:u.response,timestamp:Date.now(),persona:a,metadata:{isFallback:!0,fallbackSource:u.source,confidence:u.confidence,suggestion:u.suggestion,emergency_contact:u.emergency_contact}},t=[...s,e];c(t),O(t),d(!1);return}let m={role:"assistant",content:u.answer,timestamp:u.timestamp?new Date(u.timestamp).getTime():Date.now(),persona:u.persona},f=[...s,m];c(f),O(f),d(!1)}catch(s){if(console.error("Erro ao enviar mensagem (tentativa ".concat(t+1,"):"),s),t<3)setTimeout(()=>{F(e,a,t+1)},1e3*Math.pow(2,t)),m("Tentando novamente... (".concat(t+1,"/").concat(3,")"));else{let e=s instanceof Error?s.message:"Erro ao enviar mensagem";m("".concat(e," (Falha ap\xf3s ").concat(3," tentativas)")),d(!1)}}t>=3&&d(!1)},[i,O,k,s]),L=(0,o.useCallback)(()=>{c([]),a&&localStorage.removeItem(t),s&&S()},[a,t,s,S]),q=(0,o.useCallback)(e=>i.filter(a=>a.persona===e),[i]);return{messages:i,loading:l,error:u,sendMessage:F,clearMessages:L,getMessagesForPersona:q,currentSentiment:x,sentimentHistory:j,personaSwitchSuggestion:h,knowledgeStats:T,lastSearchResult:z,isSearchingKnowledge:A,fallbackState:N,resetFallback:_,getSystemStats:P,resetSystemFailures:D}}({persistToLocalStorage:!1,enableSentimentAnalysis:!0,enableKnowledgeEnrichment:!0}),{profile:Q,updateProfile:B,getRecommendedPersona:W}=(0,z.Gr)(),{detectProfile:G}=(0,z.So)(),{createConversation:J,switchToConversation:V,deleteConversation:Z,renameConversation:$,addMessageToConversation:Y,getCurrentMessages:ee,getConversationsForPersona:ea,currentConversationId:et}=function(){let[e,a]=(0,o.useState)([]),[t,s]=(0,o.useState)(null),[r,n]=(0,o.useState)(!1),[i,c]=(0,o.useState)(null),l=(0,o.useRef)(null);(0,o.useEffect)(()=>{try{n(!0);let e=localStorage.getItem(k);if(e){let t=JSON.parse(e);if(Array.isArray(t)){let e=t.filter(e=>e&&"object"==typeof e&&e.id&&e.personaId).slice(0,50);a(e)}}c(null)}catch(e){console.error("Erro ao carregar hist\xf3rico de conversas:",e),c("Erro ao carregar hist\xf3rico de conversas"),a([])}finally{n(!1)}},[]);let d=(0,o.useCallback)(e=>{l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{try{let a=e.slice(0,50).map(e=>({...e,messages:e.messages.slice(-100)})),t=JSON.stringify(a);if(t.length>4718592){console.warn("Dados muito grandes para localStorage, limpando conversas antigas");let e=a.slice(0,Math.floor(25));localStorage.setItem(k,JSON.stringify(e))}else localStorage.setItem(k,t);c(null)}catch(a){console.error("Erro ao salvar hist\xf3rico de conversas:",a),c("Erro ao salvar hist\xf3rico de conversas");try{let a=e.slice(0,10);localStorage.setItem(k,JSON.stringify(a))}catch(e){console.error("Erro cr\xedtico ao salvar:",e)}}},300)},[]),u=(0,o.useCallback)(e=>{try{if(!e||"string"!=typeof e)return"Nova conversa";let a=e.replace(/[^\w\sÀ-ſ]/gi,"").trim().split(" ").filter(e=>e.length>0).slice(0,6).join(" ");return a.length>40&&(a=a.substring(0,37)+"..."),a.length<3&&(a="Nova conversa"),a}catch(e){return console.error("Erro ao gerar t\xedtulo da conversa:",e),"Nova conversa"}},[]),m=(0,o.useCallback)((t,r)=>{try{if(!t||"string"!=typeof t)throw Error("personaId \xe9 obrigat\xf3rio");let n="conv_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),o=Date.now(),i=[{id:n,personaId:t,title:r?u(r):"Nova conversa",messages:[],lastActivity:o,createdAt:o},...e];return a(i),d(i),s(n),c(null),n}catch(e){return console.error("Erro ao criar conversa:",e),c("Erro ao criar nova conversa"),""}},[e,d,u]),p=(0,o.useCallback)(()=>t&&e.find(e=>e.id===t)||null,[t,e]),f=(0,o.useCallback)(s=>{if(t&&s)try{if(!s.content||!s.role||!s.timestamp)throw Error("Mensagem inv\xe1lida");let r=e.map(e=>{if(e.id===t){let a={...e,messages:[...e.messages,s].slice(-100),lastActivity:Date.now()};return 0===e.messages.length&&"user"===s.role&&(a.title=u(s.content)),a}return e});a(r),d(r),c(null)}catch(e){console.error("Erro ao adicionar mensagem:",e),c("Erro ao adicionar mensagem \xe0 conversa")}},[t,e,d,u]),h=(0,o.useCallback)(()=>{let e=p();return(null==e?void 0:e.messages)||[]},[p]),g=(0,o.useCallback)(a=>e.filter(e=>e.personaId===a).sort((e,a)=>a.lastActivity-e.lastActivity).map(e=>({id:e.id,personaId:e.personaId,title:e.title,lastMessage:e.messages.length>0?e.messages[e.messages.length-1].content.substring(0,50)+"...":"Conversa vazia",lastActivity:e.lastActivity,messageCount:e.messages.length})),[e]),y=(0,o.useCallback)(e=>{s(e)},[]),b=(0,o.useCallback)(r=>{let n=e.filter(e=>e.id!==r);a(n),d(n),t===r&&s(null)},[e,t,d]),x=(0,o.useCallback)((t,s)=>{let r=e.map(e=>e.id===t?{...e,title:s.trim()||"Conversa sem t\xedtulo"}:e);a(r),d(r)},[e,d]),v=(0,o.useCallback)(()=>{a([]),s(null),localStorage.removeItem("conversation-history")},[]),w=(0,o.useCallback)(()=>({totalConversations:e.length,totalMessages:e.reduce((e,a)=>e+a.messages.length,0),personaStats:e.reduce((e,a)=>(e[a.personaId]=(e[a.personaId]||0)+1,e),{})}),[e]);return(0,o.useEffect)(()=>()=>{l.current&&clearTimeout(l.current)},[]),{conversations:e,currentConversationId:t,loading:r,error:i,getCurrentConversation:p,getCurrentMessages:h,createConversation:m,switchToConversation:y,deleteConversation:b,renameConversation:x,clearAllConversations:v,addMessageToConversation:f,getConversationsForPersona:g,getStatistics:w,clearError:()=>c(null)}}(),[es,er]=(0,o.useState)(""),[en,eo]=(0,o.useState)(null),[ei,ec]=(0,o.useState)(!1),[el,ed]=(0,o.useState)(!1),[eu,em]=(0,o.useState)(!1),[ep,ef]=(0,o.useState)(!1),[eh,eg]=(0,o.useState)(""),ey=(0,o.useRef)(null),eb=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=()=>{ef(window.innerWidth<=768)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let ex=ee(),{currentAnalysis:ev,isAnalyzing:ew,shouldShowRouting:ek,getRecommendedPersona:ej,analyzeQuestion:eS,acceptRecommendation:eC,rejectRecommendation:eE,clearAnalysis:eA,getExplanation:ez}=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{enabled:t=!0,debounceMs:s=800,minConfidenceThreshold:r=.4}=a,[n,i]=(0,o.useState)({currentAnalysis:null,isAnalyzing:!1,error:null,hasAnalyzed:!1}),c=(0,o.useRef)(null),l=(0,o.useRef)(""),d=(0,o.useRef)({acceptedRecommendations:0,rejectedRecommendations:0,totalAnalyses:0});(0,o.useEffect)(()=>()=>{c.current&&clearTimeout(c.current)},[]);let u=(0,o.useCallback)(async a=>{if(!t||!a.trim()||0===Object.keys(e).length)return;let n=a.trim();n!==l.current&&(l.current=n,c.current&&clearTimeout(c.current),c.current=setTimeout(async()=>{i(e=>({...e,isAnalyzing:!0,error:null}));try{let a=await E(n,e);a.confidence>=r?(i(e=>({...e,currentAnalysis:a,isAnalyzing:!1,hasAnalyzed:!0})),d.current.totalAnalyses++):i(e=>({...e,currentAnalysis:null,isAnalyzing:!1,hasAnalyzed:!0}))}catch(e){console.error("Erro na an\xe1lise de roteamento:",e),i(a=>({...a,currentAnalysis:null,isAnalyzing:!1,error:e instanceof Error?e.message:"Erro na an\xe1lise",hasAnalyzed:!0}))}},s))},[t,e,r,s]),m=(0,o.useCallback)(()=>{n.currentAnalysis&&(d.current.acceptedRecommendations++,console.log("Routing recommendation accepted:",{personaId:n.currentAnalysis.recommendedPersonaId,confidence:n.currentAnalysis.confidence,scope:n.currentAnalysis.scope}))},[n.currentAnalysis]),p=(0,o.useCallback)(e=>{n.currentAnalysis&&(d.current.rejectedRecommendations++,console.log("Routing recommendation rejected:",{recommended:n.currentAnalysis.recommendedPersonaId,selected:e,confidence:n.currentAnalysis.confidence,scope:n.currentAnalysis.scope,reasoning:n.currentAnalysis.reasoning})),i(e=>({...e,currentAnalysis:null}))},[n.currentAnalysis]),f=(0,o.useCallback)(()=>{i(e=>({...e,currentAnalysis:null,error:null,hasAnalyzed:!1})),l.current="",c.current&&clearTimeout(c.current)},[]),h=(0,o.useCallback)(()=>n.currentAnalysis?function(e,a){let t=a[e.recommendedPersonaId];if(!t)return e.reasoning;let s=j[e.recommendedPersonaId]||null,r=(null==s?void 0:s.specialties.join(", "))||"quest\xf5es especializadas";return"".concat(t.name," especializa-se em ").concat(r,". ").concat(e.reasoning)}(n.currentAnalysis,e):"Nenhuma an\xe1lise dispon\xedvel",[n.currentAnalysis,e]),g=(0,o.useCallback)(()=>!!n.currentAnalysis&&n.currentAnalysis.confidence<.6,[n.currentAnalysis]),y=(0,o.useCallback)(()=>{let e=d.current,a=e.totalAnalyses>0?e.acceptedRecommendations/e.totalAnalyses*100:0;return{...e,acceptanceRate:Math.round(a)}},[]),b=(0,o.useCallback)(()=>!!(n.currentAnalysis&&n.currentAnalysis.confidence>=r&&!n.isAnalyzing),[n.currentAnalysis,n.isAnalyzing,r]),x=(0,o.useCallback)(()=>n.currentAnalysis&&e[n.currentAnalysis.recommendedPersonaId]||null,[n.currentAnalysis,e]),v=(0,o.useCallback)(()=>n.currentAnalysis?n.currentAnalysis.alternatives.filter(a=>e[a.personaId]).map(a=>({...a,persona:e[a.personaId]})):[],[n.currentAnalysis,e]);return{currentAnalysis:n.currentAnalysis,isAnalyzing:n.isAnalyzing,error:n.error,hasAnalyzed:n.hasAnalyzed,analyzeQuestion:u,acceptRecommendation:m,rejectRecommendation:p,clearAnalysis:f,getExplanation:h,isAmbiguous:g,getAnalytics:y,shouldShowRouting:b,getRecommendedPersona:x,getAlternatives:v}}(e,{enabled:!0,debounceMs:1e3,minConfidenceThreshold:.6});(0,o.useEffect)(()=>{!en&&es.length>10&&eS(es)},[es,en,eS]),(0,o.useEffect)(()=>{if(e&&Object.keys(e).length>0){let a=null;if(Q&&Q.selectedPersona&&e[Q.selectedPersona])a=Q.selectedPersona;else if(Q)a=W();else{let t=localStorage.getItem("selectedPersona");t&&e[t]&&(a=t)}a&&a!==en&&(eo(a),Q&&Q.selectedPersona!==a&&B({selectedPersona:a}),et||J(a))}},[e,Q,en,et,J,W,B]),(0,o.useEffect)(()=>{var e;null===(e=ey.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[ex]),(0,o.useEffect)(()=>{r.forEach(e=>{Y(e)})},[r,Y]);let eT=async e=>{if(e.preventDefault(),!es.trim())return;let a=es.trim();if(!en){eg(a),await eS(a);return}if(!h){er(""),ec(!1),ed(!0);try{await x(a,en)}finally{ed(!1)}}},eI=e=>{eo(e),localStorage.setItem("selectedPersona",e),J(e),eA(),eh&&(er(eh),eg(""))},eR=(0,o.useCallback)(e=>{eC(),eI(e)},[eC]),eN=(0,o.useCallback)(()=>{eE(en||"")},[eE,en]),e_=(0,o.useCallback)(()=>{console.log("Explica\xe7\xe3o do roteamento:",ez())},[ez]);if(a)return(0,s.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("div",{style:{fontSize:"2rem",marginBottom:"20px"},children:"⏳"}),(0,s.jsx)("p",{children:"Carregando chat..."})]})});if(t)return(0,s.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("div",{style:{fontSize:"2rem",marginBottom:"20px"},children:"⚠️"}),(0,s.jsxs)("p",{children:["Erro ao carregar chat: ",t]}),(0,s.jsx)(i.default,{href:"/",style:{color:d.rS.colors.primary[500],textDecoration:"underline"},children:"Voltar ao in\xedcio"})]})});let eP=en?e[en]:null;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.Z,{currentPersona:null==eP?void 0:eP.name}),(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)(R,{}),children:(0,s.jsx)(D,{conversations:Object.values(e).flatMap(a=>{let t=Object.keys(e).find(t=>e[t]===a);return t?ea(t):[]}),currentConversationId:et,personas:e,onConversationSelect:a=>{V(a);let t=Object.values(e).flatMap(a=>ea(Object.keys(e).find(t=>e[t]===a)||"")).find(e=>e.id===a);t&&(eo(t.personaId),localStorage.setItem("selectedPersona",t.personaId)),eA()},onNewConversation:e=>{J(e),eo(e),localStorage.setItem("selectedPersona",e)},onDeleteConversation:Z,onRenameConversation:$,isVisible:eu,onToggle:()=>em(!eu)})}),(0,s.jsxs)("div",{style:{height:"100vh",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",marginLeft:eu&&!ep?"320px":"0",transition:"margin-left 0.3s ease"},className:"jsx-81480df78bbb953a main-content",children:[(0,s.jsxs)("div",{style:{background:"linear-gradient(135deg, #0284c7 0%, #0369a1 100%)",color:"white",padding:ep?"12px 15px":"15px 20px",display:"flex",alignItems:"center",justifyContent:"space-between",boxShadow:"0 2px 10px rgba(0,0,0,0.1)",minHeight:"60px"},className:"jsx-81480df78bbb953a",children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"15px"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)(i.default,{href:"/",style:{color:"white",textDecoration:"none",fontSize:"1.5rem"},children:"←"}),eP&&en&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{persona:eP,personaId:en,size:"medium",showStatus:!0,isTyping:el}),(0,s.jsxs)("div",{style:{minWidth:0,flex:1},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)("h2",{style:{margin:0,fontSize:ep?"1rem":"1.2rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},className:"jsx-81480df78bbb953a",children:eP.name}),!ep&&(0,s.jsx)("p",{style:{margin:0,fontSize:"0.9rem",opacity:.8},className:"jsx-81480df78bbb953a",children:eP.personality})]})]})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)(I,{message:"Exportar"}),children:(0,s.jsx)(_,{messages:ex,currentPersona:eP,isMobile:ep})}),(0,s.jsx)(u,{personas:e,selectedPersona:en,onPersonaChange:eI,isMobile:ep})]})]}),(0,s.jsxs)("div",{style:{flex:1,overflowY:"auto",padding:ep?"15px 10px":"20px",display:"flex",flexDirection:"column",gap:ep?"12px":"15px"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)(o.Suspense,{fallback:null,children:(0,s.jsx)(q,{systemHealth:U.systemHealth,onResetFailures:K})}),!en&&!ek()&&(0,s.jsx)("div",{style:{textAlign:"center",padding:"40px",background:"rgba(255,255,255,0.7)",borderRadius:"12px",margin:"20px"},className:"jsx-81480df78bbb953a",children:(0,s.jsx)("p",{style:{fontSize:"1.1rem",color:"#666"},className:"jsx-81480df78bbb953a",children:eh?"Analisando sua pergunta para encontrar o melhor especialista...":"Digite sua pergunta ou selecione um assistente no menu acima"})}),(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)(I,{message:"Analisando..."}),children:(()=>{let a=ej();return ek()&&ev&&a&&(0,s.jsx)(M,{analysis:ev,recommendedPersona:a,currentPersonaId:en,personas:e,onAcceptRouting:eR,onRejectRouting:eN,onShowExplanation:e_,isMobile:ep})})()}),ex.map(e=>{var a;return(0,s.jsx)("div",{style:{display:"flex",justifyContent:"user"===e.role?"flex-end":"flex-start",marginBottom:"10px"},className:"jsx-81480df78bbb953a",children:(0,s.jsxs)("div",{style:{maxWidth:ep?"85%":"70%",padding:ep?"10px 14px":"12px 16px",borderRadius:"18px",background:"user"===e.role?d.rS.colors.primary[500]:"white",color:"user"===e.role?"white":"#333",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",fontSize:ep?"0.9rem":"0.95rem",lineHeight:"1.4",wordBreak:"break-word"},className:"jsx-81480df78bbb953a",children:["assistant"===e.role&&eP&&en&&(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)(l.Z,{persona:eP,personaId:en,size:"small"}),(0,s.jsx)("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:d.rS.colors.primary[500]},className:"jsx-81480df78bbb953a",children:eP.name})]}),(0,s.jsx)("div",{style:{whiteSpace:"pre-wrap"},className:"jsx-81480df78bbb953a",children:e.content}),(null===(a=e.metadata)||void 0===a?void 0:a.isFallback)&&(0,s.jsxs)("div",{style:{marginTop:"8px",padding:"6px 10px",backgroundColor:d.rS.colors.warning[50],border:"1px solid ".concat(d.rS.colors.warning[200]),borderRadius:"6px",fontSize:"0.75rem",color:d.rS.colors.warning[700]},className:"jsx-81480df78bbb953a",children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"4px"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)("span",{className:"jsx-81480df78bbb953a",children:"\uD83D\uDEE1️"}),(0,s.jsxs)("span",{className:"jsx-81480df78bbb953a",children:["Resposta de fallback (","cache"===e.metadata.fallbackSource?"Cache Local":"local_knowledge"===e.metadata.fallbackSource?"Base Local":"emergency"===e.metadata.fallbackSource?"Sistema de Emerg\xeancia":"Gen\xe9rico",")"]}),e.metadata.confidence&&(0,s.jsxs)("span",{style:{opacity:.7},className:"jsx-81480df78bbb953a",children:["- ",Math.round(100*e.metadata.confidence),"%"]})]}),e.metadata.suggestion&&(0,s.jsx)("div",{style:{marginTop:"4px",fontStyle:"italic"},className:"jsx-81480df78bbb953a",children:e.metadata.suggestion}),e.metadata.emergency_contact&&(0,s.jsx)("div",{style:{marginTop:"4px",fontWeight:"bold",color:d.rS.colors.danger[600]},className:"jsx-81480df78bbb953a",children:e.metadata.emergency_contact})]})]})},"".concat(e.role,"-").concat(e.timestamp))}),h&&eP&&en&&(0,s.jsx)("div",{style:{display:"flex",justifyContent:"flex-start",marginBottom:"10px"},className:"jsx-81480df78bbb953a",children:(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 16px",borderRadius:"18px",background:"white",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)(l.Z,{persona:eP,personaId:en,size:"small",isTyping:!0}),(0,s.jsxs)("div",{style:{display:"flex",gap:"4px",alignItems:"center"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:d.rS.colors.educational.success,animation:"pulse 1.5s infinite"},className:"jsx-81480df78bbb953a"}),(0,s.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:d.rS.colors.educational.success,animation:"pulse 1.5s infinite 0.5s"},className:"jsx-81480df78bbb953a"}),(0,s.jsx)("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:d.rS.colors.educational.success,animation:"pulse 1.5s infinite 1s"},className:"jsx-81480df78bbb953a"}),(0,s.jsxs)("span",{style:{marginLeft:"8px",fontSize:"0.9rem",color:"#666"},className:"jsx-81480df78bbb953a",children:[eP.name," est\xe1 pensando..."]})]})]})}),y&&(0,s.jsxs)("div",{style:{padding:"12px 16px",borderRadius:"8px",background:"#ffebee",color:"#c62828",textAlign:"center",margin:"10px 0"},className:"jsx-81480df78bbb953a",children:["Erro: ",y]}),(0,s.jsx)("div",{ref:ey,className:"jsx-81480df78bbb953a"})]}),(0,s.jsxs)("div",{style:{position:"relative",padding:ep?"15px 10px":"20px",background:"white",borderTop:"1px solid #eee"},className:"jsx-81480df78bbb953a",children:[(S||T||H||U.isActive||U.result)&&en&&(0,s.jsxs)("div",{style:{position:"absolute",top:"-50px",right:"20px",display:"flex",alignItems:"center",gap:"12px",flexWrap:"wrap",justifyContent:"flex-end"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)(N,{}),children:(0,s.jsx)(L,{isActive:U.isActive,result:U.result,systemHealth:U.systemHealth,attempts:U.attempts,showDetails:!ep,onRetry:()=>{let e=ex.slice().reverse().find(e=>"user"===e.role);e&&en&&x(e.content,en)},onDismiss:X})}),(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)(N,{}),children:(0,s.jsx)(F,{searchResult:T,stats:A,isSearching:H,showDetails:!ep})}),S&&(0,s.jsx)(o.Suspense,{fallback:(0,s.jsx)(N,{}),children:(0,s.jsx)(O,{sentiment:S,showDetails:!ep,size:ep?"small":"medium"})}),C&&e[C]&&(0,s.jsxs)("div",{style:{padding:"8px 12px",background:d.rS.colors.warning[50],color:d.rS.colors.warning[700],borderRadius:"8px",fontSize:"0.85rem",display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",transition:"all 0.3s ease",border:"1px solid ".concat(d.rS.colors.warning[200]),maxWidth:ep?"200px":"none"},onClick:()=>eI(C),className:"jsx-81480df78bbb953a",children:[(0,s.jsx)("span",{className:"jsx-81480df78bbb953a",children:"\uD83D\uDCA1"}),(0,s.jsxs)("span",{className:"jsx-81480df78bbb953a",children:["Sugest\xe3o: ",e[C].name," pode ajudar melhor"]})]})]}),en&&eP&&(0,s.jsx)(o.Suspense,{fallback:null,children:(0,s.jsx)(P,{persona:eP,personaId:en,currentInput:es,onSuggestionClick:e=>{var a;er(e),null===(a=eb.current)||void 0===a||a.focus()},isVisible:ei&&(0===es.length||es.length>2)})}),(0,s.jsxs)("form",{onSubmit:eT,style:{display:"flex",gap:ep?"8px":"10px",alignItems:"flex-end"},className:"jsx-81480df78bbb953a",children:[(0,s.jsx)("input",{ref:eb,type:"text",value:es,onChange:e=>er(e.target.value),onFocus:()=>ec(!0),onBlur:()=>setTimeout(()=>ec(!1),200),placeholder:en?"Pergunte ao ".concat(null==eP?void 0:eP.name,"..."):ew?"Analisando pergunta...":"Digite sua pergunta aqui...",disabled:h,style:{flex:1,padding:ep?"12px 14px":"12px 16px",borderRadius:"25px",border:"1px solid #ddd",fontSize:ep?"16px":"1rem",outline:"none",background:en?"white":"#f5f5f5",minHeight:ep?"44px":"auto"},className:"jsx-81480df78bbb953a"}),(0,s.jsx)("button",{type:"submit",disabled:!en||!es.trim()||h,style:{padding:ep?"12px 18px":"12px 20px",borderRadius:"25px",border:"none",background:en&&es.trim()&&!h?d.rS.colors.primary[500]:"#ccc",color:"white",cursor:en&&es.trim()&&!h?"pointer":"not-allowed",fontSize:ep?"1.1rem":"1rem",fontWeight:"bold",minHeight:ep?"44px":"auto",minWidth:ep?"44px":"auto"},className:"jsx-81480df78bbb953a",children:h?"⏳":"➤"})]})]}),(0,s.jsx)(n(),{id:"81480df78bbb953a",children:"@-webkit-keyframes pulse{0%,80%,100%{opacity:.3}40%{opacity:1}}@-moz-keyframes pulse{0%,80%,100%{opacity:.3}40%{opacity:1}}@-o-keyframes pulse{0%,80%,100%{opacity:.3}40%{opacity:1}}@keyframes pulse{0%,80%,100%{opacity:.3}40%{opacity:1}}"})]})]})}},319:function(e,a,t){"use strict";var s=t(7437),r=t(29),n=t.n(r),o=t(2265),i=t(3861),c=t(5121);let l=(0,o.memo)(function(e){let{persona:a,personaId:t,size:r="medium",showStatus:l=!1,isTyping:d=!1,onClick:u,ariaLabel:m,className:p=""}=e,[f,h]=(0,o.useState)(!1),[g,y]=(0,o.useState)(!1),b=(0,o.useMemo)(()=>{let e=(0,i.Qu)(t);return console.log("[PersonaAvatar] personaId: ".concat(t,", avatarUrl: ").concat(e)),e||null},[t]),x=(0,o.useMemo)(()=>(0,c.pf)(t),[t]),v=(0,o.useMemo)(()=>{switch(r){case"small":return{width:"32px",height:"32px",fontSize:"1rem"};case"large":return{width:"64px",height:"64px",fontSize:"2rem"};default:return{width:"48px",height:"48px",fontSize:"1.5rem"}}},[r]),w=(0,o.useCallback)(()=>{h(!1),y(!1)},[]),k=(0,o.useCallback)(()=>{console.warn("Erro ao carregar avatar para persona ".concat(t,":"),b),h(!0),y(!1)},[t,b]),j=(0,o.useCallback)(()=>{y(!0)},[]),S=(0,o.useCallback)(()=>{u&&!g&&u()},[u,g]),C=(0,o.useCallback)(e=>{("Enter"===e.key||" "===e.key)&&u&&!g&&(e.preventDefault(),u())},[u,g]),E="Avatar de ".concat(a.name).concat(d?", digitando":"").concat(l?", online":"");return(0,s.jsxs)("div",{role:u?"button":"img",tabIndex:u?0:-1,"aria-label":m||E,style:{position:"relative",display:"inline-block",cursor:u?"pointer":"default",outline:"none"},onClick:S,onKeyDown:C,className:"jsx-5912179cbb9301c9 "+(p||""),children:[(0,s.jsxs)("div",{style:{...v,borderRadius:"50%",background:f||!b?"linear-gradient(135deg, ".concat(x.primaryColor," 0%, ").concat(x.secondaryColor," 100%)"):"white",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",boxShadow:"0 4px 12px ".concat(x.primaryColor,"30"),transition:"all 0.3s ease",border:d?"3px solid ".concat(c.rS.colors.educational.success):"3px solid ".concat(x.accentColor,"40"),animation:d?"pulse 2s infinite":"none",overflow:"hidden"},onMouseEnter:e=>{u&&!g&&(e.currentTarget.style.transform="scale(1.1)",e.currentTarget.style.boxShadow="0 6px 20px ".concat(x.primaryColor,"40"))},onMouseLeave:e=>{u&&(e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 12px ".concat(x.primaryColor,"30"))},onFocus:e=>{u&&(e.currentTarget.style.outline="2px solid ".concat(x.primaryColor),e.currentTarget.style.outlineOffset="2px")},onBlur:e=>{u&&(e.currentTarget.style.outline="none")},className:"jsx-5912179cbb9301c9",children:[g&&(0,s.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.8rem",color:"white"},className:"jsx-5912179cbb9301c9",children:"⏳"}),!f&&b?(0,s.jsx)("img",{src:b,alt:"Avatar de ".concat(a.name,", especialista em ").concat(a.target_audience||"sa\xfade"),loading:"lazy",decoding:"async",width:parseInt(v.width),height:parseInt(v.height),style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%",opacity:g?.5:1,transition:"opacity 0.3s ease"},onError:k,onLoad:w,onLoadStart:j,className:"jsx-5912179cbb9301c9"}):(0,s.jsx)("span",{style:{fontSize:v.fontSize,color:"white",fontWeight:"bold",userSelect:"none"},"aria-hidden":"true",className:"jsx-5912179cbb9301c9",children:a.avatar||a.name.charAt(0).toUpperCase()})]}),l&&(0,s.jsx)("div",{"aria-label":d?"Digitando":"Online",style:{position:"absolute",bottom:"2px",right:"2px",width:"small"===r?"8px":"large"===r?"16px":"12px",height:"small"===r?"8px":"large"===r?"16px":"12px",borderRadius:"50%",background:d?"#4caf50":"#2196f3",border:"2px solid white",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",animation:d?"pulse 2s infinite":"none"},className:"jsx-5912179cbb9301c9"}),d&&(0,s.jsx)("div",{"aria-live":"polite","aria-label":"Digitando",style:{position:"absolute",top:"-8px",right:"-8px",background:"#4caf50",color:"white",borderRadius:"12px",padding:"2px 6px",fontSize:"0.7rem",fontWeight:"bold",animation:"bounce 1s infinite",userSelect:"none",pointerEvents:"none"},className:"jsx-5912179cbb9301c9",children:(0,s.jsx)("span",{"aria-hidden":"true",className:"jsx-5912179cbb9301c9",children:"..."})}),(0,s.jsx)(n(),{id:"5912179cbb9301c9",children:"@-webkit-keyframes pulse{0%{border-color:#4caf50}50%{border-color:#81c784}100%{border-color:#4caf50}}@-moz-keyframes pulse{0%{border-color:#4caf50}50%{border-color:#81c784}100%{border-color:#4caf50}}@-o-keyframes pulse{0%{border-color:#4caf50}50%{border-color:#81c784}100%{border-color:#4caf50}}@keyframes pulse{0%{border-color:#4caf50}50%{border-color:#81c784}100%{border-color:#4caf50}}@-webkit-keyframes bounce{0%,20%,50%,80%,100%{-webkit-transform:translatey(0);transform:translatey(0)}40%{-webkit-transform:translatey(-4px);transform:translatey(-4px)}60%{-webkit-transform:translatey(-2px);transform:translatey(-2px)}}@-moz-keyframes bounce{0%,20%,50%,80%,100%{-moz-transform:translatey(0);transform:translatey(0)}40%{-moz-transform:translatey(-4px);transform:translatey(-4px)}60%{-moz-transform:translatey(-2px);transform:translatey(-2px)}}@-o-keyframes bounce{0%,20%,50%,80%,100%{-o-transform:translatey(0);transform:translatey(0)}40%{-o-transform:translatey(-4px);transform:translatey(-4px)}60%{-o-transform:translatey(-2px);transform:translatey(-2px)}}@keyframes bounce{0%,20%,50%,80%,100%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0)}40%{-webkit-transform:translatey(-4px);-moz-transform:translatey(-4px);-o-transform:translatey(-4px);transform:translatey(-4px)}60%{-webkit-transform:translatey(-2px);-moz-transform:translatey(-2px);-o-transform:translatey(-2px);transform:translatey(-2px)}}"})]})});a.Z=l},2983:function(e,a,t){"use strict";t.d(a,{H:function(){return l}});var s=t(2265),r=t(8223),n=t(3861);class o{generateKey(e,a){let t=a?JSON.stringify(a):"";return"".concat(e).concat(t)}isExpired(e){return Date.now()-e.timestamp>e.ttl}cleanup(){let e=[];this.cache.forEach((a,t)=>{this.isExpired(a)&&e.push(t)}),e.forEach(e=>this.cache.delete(e))}evictOldest(){if(this.cache.size>=this.maxSize){let e=null,a=1/0;this.cache.forEach((t,s)=>{t.timestamp<a&&(a=t.timestamp,e=s)}),e&&this.cache.delete(e)}}get(e,a){this.cleanup();let t=this.generateKey(e,a),s=this.cache.get(t);return!s||this.isExpired(s)?(s&&this.cache.delete(t),null):(s.timestamp=Date.now(),s.data)}set(e,a,t,s){this.evictOldest();let r=this.generateKey(e,t),n={data:a,timestamp:Date.now(),ttl:s||this.defaultTTL,key:r};this.cache.set(r,n)}delete(e,a){let t=this.generateKey(e,a);this.cache.delete(t)}clear(){this.cache.clear()}getStats(){let e=[];return this.cache.forEach((a,t)=>e.push(t)),{size:this.cache.size,maxSize:this.maxSize,keys:e,hitRate:0}}preload(e,a,t,s){this.set(e,a,t,s)}constructor(){this.cache=new Map,this.maxSize=50,this.defaultTTL=3e5}}let i=new o,c={get:()=>i.get("personas",void 0),set:e=>i.set("personas",e,void 0,18e5)};function l(){let[e,a]=(0,s.useState)({}),[t,o]=(0,s.useState)(!0),[i,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async function(){try{o(!0),l(null);let e=c.get();if(e){a(e),o(!1);return}let t=await (0,r.H7)(),s=(0,n.bt)(t);c.set(s),a(s)}catch(e){console.error("Erro ao carregar personas:",e),l(e instanceof Error?e.message:"Erro desconhecido")}finally{o(!1)}})()},[]),{personas:e,loading:t,error:i,getPersonaById:a=>e[a]||null,getPersonasList:()=>Object.entries(e).map(e=>{let[a,t]=e;return{id:a,persona:t}}),getValidPersonasCount:()=>Object.keys(e).length,refetch:async()=>{try{o(!0),l(null);let e=await (0,r.H7)(),t=(0,n.bt)(e);a(t)}catch(e){console.error("Erro ao carregar personas:",e),l(e instanceof Error?e.message:"Erro desconhecido")}finally{o(!1)}}}}},8497:function(e,a,t){"use strict";t.d(a,{Gr:function(){return o},So:function(){return i}});var s=t(2265);let r="userProfile",n={language:"simple",notifications:!0,theme:"auto"};function o(){let[e,a]=(0,s.useState)(null),[t,o]=(0,s.useState)(!0);(0,s.useEffect)(()=>{try{let e=localStorage.getItem(r);if(e){let t=JSON.parse(e);"1.0"===t.version?a(t.profile):(console.log("Migrando perfil para nova vers\xe3o"),localStorage.removeItem(r))}}catch(e){console.error("Erro ao carregar perfil do usu\xe1rio:",e),localStorage.removeItem(r)}finally{o(!1)}},[]);let i=t=>{try{var s,o;let i={...t,preferences:{...n,...t.preferences},history:{lastPersona:t.selectedPersona||"ga",conversationCount:((null==e?void 0:null===(s=e.history)||void 0===s?void 0:s.conversationCount)||0)+1,lastAccess:new Date().toISOString(),preferredTopics:(null==e?void 0:null===(o=e.history)||void 0===o?void 0:o.preferredTopics)||[]}},c={version:"1.0",profile:i,savedAt:new Date().toISOString()};localStorage.setItem(r,JSON.stringify(c)),a(i)}catch(e){console.error("Erro ao salvar perfil do usu\xe1rio:",e)}};return{profile:e,isLoading:t,saveProfile:i,updateProfile:a=>{var t,s,r;e&&i({...e,...a,history:{lastPersona:a.selectedPersona||(null===(t=e.history)||void 0===t?void 0:t.lastPersona)||"ga",conversationCount:(null===(s=e.history)||void 0===s?void 0:s.conversationCount)||0,lastAccess:new Date().toISOString(),preferredTopics:(null===(r=e.history)||void 0===r?void 0:r.preferredTopics)||[]}})},clearProfile:()=>{try{localStorage.removeItem(r),a(null)}catch(e){console.error("Erro ao limpar perfil do usu\xe1rio:",e)}},getRecommendedPersona:()=>{if(!e)return"ga";let{type:a,focus:t,history:s}=e;return(null==s?void 0:s.lastPersona)&&s.conversationCount>2?s.lastPersona:"professional"===a||"student"===a?"technical"===t?"dr_gasnelio":"practical"===t?"ga":"dr_gasnelio":"technical"===t?"dr_gasnelio":"ga"},hasProfile:null!==e}}function i(){let e=["posologia","farmacocin\xe9tica","mecanismo de a\xe7\xe3o","intera\xe7\xf5es medicamentosas","farmacologia cl\xednica","protocolo","diretrizes t\xe9cnicas","evid\xeancia cient\xedfica","dose","administra\xe7\xe3o","monitoriza\xe7\xe3o","contraindica\xe7\xe3o"],a=["como tomar","efeitos","normal","preocupado","posso","faz mal","\xe9 perigoso","vai passar","medo","ansioso","fam\xedlia","cuidador","ajudar","explicar","simples","entender"];return{detectProfile:t=>{let s=t.toLowerCase(),r=e.reduce((e,a)=>e+(s.includes(a)?1:0),0),n=a.reduce((e,a)=>e+(s.includes(a)?1:0),0),o=r+n,i="ga",c=.5,l="Baseado no seu perfil, recomendo come\xe7ar com G\xe1 para uma abordagem mais acolhedora.";return o>0&&(r>n?(i="dr_gasnelio",c=Math.min(.9,.6+r/(o+2)),l="Detectei interesse em informa\xe7\xf5es t\xe9cnicas. Dr. Gasnelio \xe9 especialista em aspectos cient\xedficos."):n>r?(i="ga",c=Math.min(.9,.6+n/(o+2)),l="Percebo que busca informa\xe7\xf5es pr\xe1ticas e acolhedoras. G\xe1 \xe9 ideal para esse tipo de orienta\xe7\xe3o."):(c=.5,l="Ambos especialistas podem ajudar. G\xe1 oferece explica\xe7\xf5es mais simples, Dr. Gasnelio \xe9 mais t\xe9cnico.")),{recommended:i,confidence:c,explanation:l}}}}},8223:function(e,a,t){"use strict";t.d(a,{$N:function(){return o},H7:function(){return r},bE:function(){return n}});let s="https://roteiro-dispensacao-api-1016586236354.us-central1.run.app";async function r(){try{let e=await fetch("".concat(s,"/api/personas"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}catch(e){throw console.error("Erro ao buscar personas:",e),e}}async function n(e){try{let a=await fetch("".concat(s,"/api/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}catch(e){throw console.error("Erro ao enviar mensagem:",e),e}}async function o(e){try{let a=await fetch("".concat(s,"/api/scope"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e})});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}catch(e){throw console.error("Erro ao detectar escopo:",e),e}}},6830:function(e,a,t){"use strict";var s,r;t.d(a,{$o:function(){return i},XI:function(){return s},rn:function(){return c}}),(r=s||(s={})).POSITIVE="positive",r.NEUTRAL="neutral",r.CONCERNED="concerned",r.ANXIOUS="anxious",r.FRUSTRATED="frustrated";let n=new Map;class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}async analyze(e){let a=e.toLowerCase().trim(),t=this.getCachedResult(a);if(t)return t;let s=await this.performLocalAnalysis(a);return this.cacheResult(a,s),s}async performLocalAnalysis(e){let{sentimentKeywords:a}=await t.e(543).then(t.bind(t,7543)),s=0,r=0,n=[],o=0;for(let[t,i]of Object.entries(a))for(let a of i){let t=RegExp("\\b".concat(a.word,"\\b"),"gi"),i=e.match(t);if(i){let e=a.weight*i.length;s+=e,r+=Math.abs(e),o+=i.length,n.push(a.word)}}o>0&&(s=Math.max(-1,Math.min(1,s/o)),r=Math.min(1,r/o));let i=this.analyzeEmojis(e);s=(s+i.score)/2,r=Math.max(r,i.magnitude);let c=this.determineCategory(s,r);return{score:s,magnitude:r,category:c,confidence:Math.min(1,(n.length+i.count)/5),keywords:n.slice(0,5)}}analyzeEmojis(e){let a=(e.match(/😊|😃|😄|😁|🙂|👍|❤️|💚|✅|🎉/g)||[]).length,t=(e.match(/😟|😰|😔|😢|😭|😡|😤|👎|❌|💔/g)||[]).length,s=a+t+(e.match(/🤔|😕|🧐|❓|⁉️/g)||[]).length;return 0===s?{score:0,magnitude:0,count:0}:{score:(a-t)/s,magnitude:Math.min(1,s/3),count:s}}determineCategory(e,a){if(a>.7){if(e>.3)return"positive";if(e<-.5)return"frustrated";if(e<-.2)return"anxious"}return e>.2?"positive":e<-.4?"frustrated":e<-.2?"anxious":.2>Math.abs(e)&&a>.3?"concerned":"neutral"}getCachedResult(e){let a=n.get(e);return a&&Date.now()-a.timestamp<3e5?a.result:(a&&n.delete(e),null)}cacheResult(e,a){if(n.size>=100){let e=n.keys().next().value;e&&n.delete(e)}n.set(e,{result:a,timestamp:Date.now()})}clearCache(){n.clear()}constructor(){}}let i=o.getInstance();function c(e,a){return"dr-gasnelio"===a&&("anxious"===e.category||"frustrated"===e.category)&&e.confidence>.7||"ga"===a&&"neutral"===e.category&&e.magnitude<.3&&e.confidence>.7}}},function(e){e.O(0,[29,448,145,768,971,117,744],function(){return e(e.s=1340)}),_N_E=e.O()}]);