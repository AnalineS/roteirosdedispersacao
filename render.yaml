services:
  - type: web
    name: roteiro-dispensacao
    env: python
    plan: free
    buildCommand: |
      echo "泅 Iniciando build otimizado para produﾃｧﾃ｣o..."
      pip install --no-cache-dir --upgrade pip
      pip install --no-cache-dir -r requirements.txt
      echo "沒ｦ Dependﾃｪncias Python instaladas"
      echo "沐ｨ Buildando frontend React..."
      cd src/frontend
      npm install
      npm run build
      echo "笨 Frontend buildado com sucesso"
      cd ../..
      python --version
      echo "笨 Build completo concluﾃｭdo com sucesso"
    startCommand: |
      echo "泅 Iniciando aplicaﾃｧﾃ｣o em produﾃｧﾃ｣o..."
      echo "Diretﾃｳrio atual: $(pwd)"
      echo "Listando conteﾃｺdo: $(ls -la)"
      python src/backend/main.py
    healthCheckPath: /api/health
    envVars:
      # === CONFIGURAﾃﾃグ GERAL ===
      - key: FLASK_APP
        value: main.py
      - key: FLASK_ENV
        value: production
      - key: FLASK_DEBUG
        value: false
      - key: PORT
        value: 10000
      
      # === CONFIGURAﾃﾃグ PYTHON ===
      - key: PYTHONPATH
        value: /opt/render/project/src:/opt/render/project/src/backend
      - key: PYTHONUNBUFFERED
        value: "1"
      
      # === APIs EXTERNAS ===
      - key: HUGGINGFACE_API_KEY
        sync: false  # Configurar no dashboard do Render
      - key: OPENROUTER_API_KEY
        sync: false  # Configurar no dashboard do Render
      
      # === CONFIGURAﾃﾃグ DE LOGS ===
      - key: LOG_LEVEL
        value: INFO
      - key: LOG_FORMAT
        value: structured
      
      # === CONFIGURAﾃﾃグ DE PERFORMANCE ===
      - key: CACHE_ENABLED
        value: "true"
      - key: TIMEOUT_SECONDS
        value: "30"
      
      # === MONITORAMENTO ===
      - key: HEALTH_CHECK_ENABLED
        value: "true"
      - key: METRICS_ENABLED
        value: "true"
        
    autoDeploy: true
    region: oregon
    runtime: python-3.11.0
    scaling:
      minInstances: 1
      maxInstances: 3
    disk:
      name: roteiro-data
      mountPath: /opt/render/project/data
      sizeGB: 1