# CodeQL Configuration for Medical Educational Platform - Optimized for False Positive Reduction
# Configuração específica para análise de segurança de plataforma médico-educacional
#
# Esta configuração customiza o CodeQL para:
# - Focar APENAS em vulnerabilidades críticas reais
# - Suprimir falsos positivos conhecidos de dependências
# - Analisar padrões específicos de segurança médica com precisão
# - Detectar problemas de validação de dados clínicos sem ruído
# - Identificar vazamentos de informações sensíveis genuínos

name: "Medical Platform Security Analysis - Optimized"

# Consultas personalizadas para plataforma médica - Focadas e Precisas
queries:
  # APENAS consultas de alta precisão para reduzir falsos positivos
  - uses: security-extended
  - exclude:
      # Excluir queries que geram muitos falsos positivos
      - id: js/unused-local-variable
      - id: js/unreachable-statement
      - id: py/unused-import
      - id: py/unused-local-variable
      - id: js/inconsistent-use-of-new
      - id: py/redundant-assignment
      - id: js/duplicate-property
      - id: py/similar-function

  # Consultas customizadas com foco médico (comentadas até serem criadas)
  # - name: Medical data validation
  #   uses: ./.github/queries/medical-validation.ql
  # - name: Input sanitization
  #   uses: ./.github/queries/input-sanitization.ql

# Configuração por linguagem - Otimizada para reduzir falsos positivos
paths-ignore:
  # Ignorar arquivos de teste e temporários (grandes geradores de falsos positivos)
  - "**/*test*"
  - "**/*spec*"
  - "**/tests/**"
  - "**/__tests__/**"
  - "**/test/**"
  - "**/spec/**"

  # Ignorar dependências externas (principal fonte de falsos positivos)
  - "**/node_modules/**"
  - "**/venv/**"
  - "**/__pycache__/**"
  - "**/site-packages/**"
  - "**/vendor/**"
  - "**/third_party/**"

  # Ignorar arquivos de build (não são código de produção)
  - "**/build/**"
  - "**/dist/**"
  - "**/out/**"
  - "**/.next/**"
  - "**/coverage/**"
  - "**/logs/**"
  - "**/temp/**"
  - "**/tmp/**"

  # Ignorar arquivos de configuração gerados automaticamente
  - "**/*.min.js"
  - "**/*.bundle.js"
  - "**/.cache/**"
  - "**/public/static/**"

  # Ignorar arquivos específicos que geram falsos positivos conhecidos
  - "**/package-lock.json"
  - "**/yarn.lock"
  - "**/poetry.lock"
  - "**/Pipfile.lock"
  - "**/*.d.ts"
  - "**/types/**/*.ts"
  
paths:
  # Focar em código de produção crítico
  - "apps/backend/main.py"
  - "apps/backend/blueprints/**"
  - "apps/backend/core/**"
  - "apps/backend/services/**"
  - "apps/frontend-nextjs/src/**"

# Configurações específicas para Python
python:
  # Bibliotecas essenciais para análise médica
  setup-python-dependencies: true
  python-executable: python3
  
  # Dependências críticas para análise
  dependencies:
    - flask
    - flask-cors
    - pydantic
    - bleach
    - openai
    - requests
    
# Configurações específicas para JavaScript/TypeScript  
javascript:
  # Incluir TypeScript
  typescript: true
  
  # Configuração do Node.js
  node-version: "18"
  
  # Dependências essenciais
  setup-javascript-dependencies: true

# Configurações de análise avançada
compilation-options:
  # Análise mais profunda para sistemas médicos
  enable-deep-analysis: true
  
  # Timeout estendido para análise completa
  timeout: 30m
  
  # Threads para análise paralela
  threads: 4

# Configurações de relatório
reporting:
  # Incluir contexto adicional nos alerts
  include-source-context: true
  
  # Agrupar por categoria de segurança
  group-by-severity: true
  
  # Focar em vulnerabilidades de alta severidade
  minimum-severity: medium

# Filtros específicos para plataforma médica - Agressivos para reduzir falsos positivos
filters:
  # Excluir falsos positivos conhecidos (lista expandida)
  exclude:
    # Falsos positivos de desenvolvimento
    - "Test files should not be analyzed"
    - "Development configuration detected"
    - "Debug mode enabled in development"
    - "Console logging detected"
    - "TODO comment found"
    - "Unused variable in test file"
    - "Mock object detected"

    # Falsos positivos de dependências
    - "Third-party library vulnerability"
    - "Dependency scanning alert"
    - "Package vulnerability in node_modules"
    - "Transitive dependency issue"
    - "Lock file vulnerability"

    # Falsos positivos de configuração
    - "Configuration file issue"
    - "Environment variable usage"
    - "Docker configuration warning"
    - "Build script issue"

    # Falsos positivos de código gerado
    - "Generated code warning"
    - "Compiled output issue"
    - "Minified file warning"
    - "Type definition issue"

  # Priorizar APENAS problemas médicos críticos REAIS
  include:
    # Vulnerabilidades de segurança críticas
    - "SQL injection vulnerability"
    - "Cross-site scripting vulnerability"
    - "Improper input validation"
    - "Authentication bypass"
    - "Authorization flaw"
    - "Session management flaw"

    # Problemas específicos de dados médicos
    - "Sensitive data exposure"
    - "Medical data leak"
    - "Patient information disclosure"
    - "Insecure data storage"
    - "Inadequate encryption"

    # Problemas de integridade críticos
    - "Code injection"
    - "Command injection"
    - "Path traversal"
    - "Remote code execution"

# Configurações de performance
performance:
  # Cache para análises incrementais
  enable-cache: true
  
  # Análise incremental quando possível
  incremental-analysis: true
  
  # Otimização para repositórios médicos
  medical-platform-optimizations: true

# Configurações de compliance
compliance:
  # Padrões de conformidade médica
  medical-standards:
    - "LGPD" # Lei Geral de Proteção de Dados
    - "CFM-2314-2022" # Resolução CFM sobre Telemedicina
    - "ANVISA-RDC-4-2009" # Farmacovigilância
    
  # Verificações de segurança médica
  medical-security-checks:
    - patient-data-protection
    - medication-calculation-validation
    - clinical-data-sanitization
    - medical-disclaimer-compliance
    
# Configurações de notificação
notifications:
  # Notificar sobre vulnerabilidades críticas
  critical-vulnerabilities: true
  
  # Relatório semanal de segurança
  weekly-security-report: true
  
  # Alertas para compliance médico
  medical-compliance-alerts: true