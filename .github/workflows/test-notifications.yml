name: ğŸ”” Test Notifications

on:
  workflow_dispatch:
    inputs:
      test_message:
        description: 'Mensagem de teste para enviar'
        required: false
        default: 'Teste de notificaÃ§Ãµes do Telegram'
        type: string

jobs:
  test-telegram:
    name: Test Telegram Notifications
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¤ Send Test Notification
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          echo "ğŸ”” Enviando notificaÃ§Ã£o de teste..."
          
          MESSAGE="ğŸ§ª [TESTE] NotificaÃ§Ã£o de Teste"
          MESSAGE="$MESSAGE%0AğŸ“ Mensagem: ${{ github.event.inputs.test_message }}"
          MESSAGE="$MESSAGE%0AğŸ“… Data: $(date)"
          MESSAGE="$MESSAGE%0AğŸ‘¤ Disparado por: ${{ github.actor }}"
          MESSAGE="$MESSAGE%0AğŸ”— Workflow: ${{ github.workflow }}"
          MESSAGE="$MESSAGE%0Aâœ… Se vocÃª recebeu esta mensagem, as notificaÃ§Ãµes estÃ£o funcionando!"
          
          RESPONSE=$(curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage" \
            -d chat_id="$TELEGRAM_CHAT_ID" \
            -d text="$MESSAGE" \
            -d parse_mode="HTML")
          
          echo "Resposta do Telegram:"
          echo "$RESPONSE" | jq '.' || echo "$RESPONSE"
          
          if echo "$RESPONSE" | grep -q '"ok":true'; then
            echo "âœ… NotificaÃ§Ã£o enviada com sucesso!"
          else
            echo "âŒ Erro ao enviar notificaÃ§Ã£o"
            exit 1
          fi
      
      - name: ğŸ“Š Show Configuration Status
        run: |
          echo "ğŸ“‹ Status da ConfiguraÃ§Ã£o:"
          echo "=========================="
          
          if [ -n "${{ secrets.TELEGRAM_BOT_TOKEN }}" ]; then
            echo "âœ… TELEGRAM_BOT_TOKEN configurado"
          else
            echo "âŒ TELEGRAM_BOT_TOKEN nÃ£o configurado"
          fi
          
          if [ -n "${{ secrets.TELEGRAM_CHAT_ID }}" ]; then
            echo "âœ… TELEGRAM_CHAT_ID configurado"
          else
            echo "âŒ TELEGRAM_CHAT_ID nÃ£o configurado"
          fi
          
          echo ""
          echo "ğŸ” Para verificar todos os secrets:"
          echo "   Settings â†’ Secrets and variables â†’ Actions"