<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard M√©dico - Hansen√≠ase | Fase 3</title>
    <meta name="description" content="Dashboard de produ√ß√£o para monitoramento da plataforma educacional m√©dica sobre hansen√≠ase">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    
    <!-- Accessibility -->
    <meta name="theme-color" content="#2563eb">
    
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --border-radius: 8px;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-family);
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        .header {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary-color);
        }
        
        .header h1 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .status-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            text-align: center;
            transition: transform 0.2s ease;
        }
        
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .status-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .status-card .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .status-card .label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .status-card.success { border-top: 4px solid var(--success-color); }
        .status-card.warning { border-top: 4px solid var(--warning-color); }
        .status-card.danger { border-top: 4px solid var(--danger-color); }
        .status-card.info { border-top: 4px solid var(--info-color); }
        
        .status-card.success .value { color: var(--success-color); }
        .status-card.warning .value { color: var(--warning-color); }
        .status-card.danger .value { color: var(--danger-color); }
        .status-card.info .value { color: var(--info-color); }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
        }
        
        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .refresh-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s ease;
        }
        
        .refresh-btn:hover {
            background: #1d4ed8;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .metric {
            text-align: center;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: #f9fafb;
        }
        
        .metric .value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .metric .label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .calculator-status {
            margin-bottom: 1.5rem;
        }
        
        .calculator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: #f9fafb;
        }
        
        .calculator-name {
            font-weight: 600;
        }
        
        .calculator-precision {
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-weight: 600;
        }
        
        .precision-excellent { background: #dcfce7; color: #166534; }
        .precision-good { background: #fef3c7; color: #92400e; }
        .precision-poor { background: #fecaca; color: #991b1b; }
        
        .alert-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: var(--border-radius);
            border-left: 4px solid;
            font-size: 0.875rem;
        }
        
        .alert-critical {
            background: #fef2f2;
            border-color: var(--danger-color);
            color: #7f1d1d;
        }
        
        .alert-warning {
            background: #fffbeb;
            border-color: var(--warning-color);
            color: #78350f;
        }
        
        .alert-info {
            background: #eff6ff;
            border-color: var(--info-color);
            color: #1e40af;
        }
        
        .timestamp {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .progress-bar {
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
            margin: 0.5rem 0;
        }
        
        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .progress-excellent { background: var(--success-color); }
        .progress-good { background: var(--warning-color); }
        .progress-poor { background: var(--danger-color); }
        
        .accessibility-score {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .score-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }
        
        .bottom-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .log-entry {
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            background: #f9fafb;
            font-size: 0.75rem;
            font-family: 'Courier New', monospace;
        }
        
        .log-timestamp {
            color: var(--text-secondary);
        }
        
        .log-level-INFO { border-left: 3px solid var(--info-color); }
        .log-level-WARNING { border-left: 3px solid var(--warning-color); }
        .log-level-ERROR { border-left: 3px solid var(--danger-color); }
        .log-level-SUCCESS { border-left: 3px solid var(--success-color); }
        
        .persona-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .persona-card {
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: #f9fafb;
        }
        
        .persona-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }
        
        .persona-icon {
            font-size: 1.25rem;
        }
        
        .persona-name {
            font-weight: 600;
        }
        
        .persona-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .auto-refresh {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 0.75rem;
            box-shadow: var(--shadow);
            font-size: 0.875rem;
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Responsive design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard {
                padding: 0.5rem;
            }
            
            .status-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .persona-stats {
                grid-template-columns: 1fr;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #0f172a;
                --card-bg: #1e293b;
                --text-primary: #f1f5f9;
                --text-secondary: #94a3b8;
                --border-color: #334155;
            }
            
            .metric, .calculator-item, .persona-card {
                background: #334155;
            }
            
            .log-entry {
                background: #334155;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <h1>üè• Dashboard M√©dico - Hansen√≠ase</h1>
            <p class="subtitle">
                Monitoramento em tempo real da plataforma educacional m√©dica | 
                Fase 3 - Sistema de Produ√ß√£o | 
                <span id="last-update">Carregando...</span>
            </p>
        </header>

        <!-- Auto-refresh indicator -->
        <div class="auto-refresh" id="auto-refresh">
            üîÑ Auto-refresh: <span id="refresh-countdown">30s</span>
        </div>

        <!-- Status Overview -->
        <div class="status-bar">
            <div class="status-card success">
                <div class="icon">‚úÖ</div>
                <div class="value" id="system-status">OPERACIONAL</div>
                <div class="label">Status do Sistema</div>
            </div>
            
            <div class="status-card success">
                <div class="icon">üßÆ</div>
                <div class="value" id="precision-avg">99.4%</div>
                <div class="label">Precis√£o M√©dica</div>
            </div>
            
            <div class="status-card success">
                <div class="icon">üõ°Ô∏è</div>
                <div class="value" id="lgpd-score">98%</div>
                <div class="label">LGPD Compliance</div>
            </div>
            
            <div class="status-card success">
                <div class="icon">‚ôø</div>
                <div class="value" id="accessibility-score">96%</div>
                <div class="label">Acessibilidade WCAG</div>
            </div>
            
            <div class="status-card info">
                <div class="icon">üë•</div>
                <div class="value" id="active-users">127</div>
                <div class="label">Usu√°rios Ativos</div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="main-content">
            <!-- Left Column: Medical Quality -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üè• Qualidade M√©dica</h2>
                    <button class="refresh-btn" onclick="refreshMedicalData()">Atualizar</button>
                </div>
                
                <!-- Medical Calculators Status -->
                <div class="calculator-status">
                    <h3 style="margin-bottom: 1rem; color: var(--text-primary);">üìä Calculadoras M√©dicas</h3>
                    
                    <div class="calculator-item">
                        <div>
                            <div class="calculator-name">Rifampicina</div>
                            <div class="timestamp">√öltima valida√ß√£o: 2 min atr√°s</div>
                        </div>
                        <div class="calculator-precision precision-excellent">99.7%</div>
                    </div>
                    
                    <div class="calculator-item">
                        <div>
                            <div class="calculator-name">Dapsona</div>
                            <div class="timestamp">√öltima valida√ß√£o: 5 min atr√°s</div>
                        </div>
                        <div class="calculator-precision precision-excellent">99.2%</div>
                    </div>
                    
                    <div class="calculator-item">
                        <div>
                            <div class="calculator-name">Esquema PQT</div>
                            <div class="timestamp">√öltima valida√ß√£o: 1 min atr√°s</div>
                        </div>
                        <div class="calculator-precision precision-excellent">99.8%</div>
                    </div>
                    
                    <div class="calculator-item">
                        <div>
                            <div class="calculator-name">Baciloscopia</div>
                            <div class="timestamp">√öltima valida√ß√£o: 8 min atr√°s</div>
                        </div>
                        <div class="calculator-precision precision-good">98.1%</div>
                    </div>
                </div>
                
                <!-- Performance by Persona -->
                <div class="persona-stats">
                    <div class="persona-card">
                        <div class="persona-header">
                            <span class="persona-icon">üë®‚Äç‚öïÔ∏è</span>
                            <span class="persona-name">Dr. Gasnelio</span>
                        </div>
                        <div class="persona-metrics">
                            <div>LCP: <strong>1.6s</strong></div>
                            <div>FID: <strong>78ms</strong></div>
                            <div>Usu√°rios: <strong>23</strong></div>
                            <div>Satisfa√ß√£o: <strong>97%</strong></div>
                        </div>
                    </div>
                    
                    <div class="persona-card">
                        <div class="persona-header">
                            <span class="persona-icon">üë©‚Äçüíº</span>
                            <span class="persona-name">GA Learning</span>
                        </div>
                        <div class="persona-metrics">
                            <div>LCP: <strong>2.4s</strong></div>
                            <div>FID: <strong>112ms</strong></div>
                            <div>Usu√°rios: <strong>67</strong></div>
                            <div>Satisfa√ß√£o: <strong>94%</strong></div>
                        </div>
                    </div>
                </div>
                
                <!-- Medical Metrics -->
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="value">247</div>
                        <div class="label">Casos Teste</div>
                    </div>
                    <div class="metric">
                        <div class="value">0</div>
                        <div class="label">Dados Sens√≠veis</div>
                    </div>
                    <div class="metric">
                        <div class="value">100%</div>
                        <div class="label">Protocolos MS</div>
                    </div>
                    <div class="metric">
                        <div class="value">45ms</div>
                        <div class="label">Tempo Resposta</div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Alerts & Compliance -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üö® Alertas & Compliance</h2>
                    <button class="refresh-btn" onclick="refreshAlerts()">Atualizar</button>
                </div>
                
                <!-- Active Alerts -->
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem; color: var(--text-primary);">‚ö†Ô∏è Alertas Ativos (0)</h3>
                    <div class="alert-item alert-info">
                        <strong>‚ÑπÔ∏è Sistema Operacional</strong><br>
                        Todos os sistemas funcionando normalmente. Nenhum alerta cr√≠tico ativo.
                        <div class="timestamp">06/09/2025 15:23:45</div>
                    </div>
                </div>
                
                <!-- LGPD Compliance -->
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem; color: var(--text-primary);">üõ°Ô∏è LGPD Compliance</h3>
                    
                    <div style="margin-bottom: 0.5rem;">
                        <strong>Detec√ß√£o Dados Sens√≠veis</strong>
                        <div class="progress-bar">
                            <div class="progress-fill progress-excellent" style="width: 100%"></div>
                        </div>
                        <small>100% - Nenhum dado sens√≠vel detectado</small>
                    </div>
                    
                    <div style="margin-bottom: 0.5rem;">
                        <strong>Consentimento Ativo</strong>
                        <div class="progress-bar">
                            <div class="progress-fill progress-excellent" style="width: 98%"></div>
                        </div>
                        <small>98% - Cobertura de consentimento</small>
                    </div>
                    
                    <div style="margin-bottom: 0.5rem;">
                        <strong>Logs de Auditoria</strong>
                        <div class="progress-bar">
                            <div class="progress-fill progress-excellent" style="width: 96%"></div>
                        </div>
                        <small>96% - Auditoria completa</small>
                    </div>
                </div>
                
                <!-- Accessibility Score -->
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="margin-bottom: 1rem; color: var(--text-primary);">‚ôø Acessibilidade WCAG</h3>
                    
                    <div class="accessibility-score">
                        <div class="score-circle" style="background: var(--success-color);">96%</div>
                        <div>
                            <div><strong>WCAG 2.1 AA</strong></div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                Perceivable: 98% | Operable: 96%<br>
                                Understandable: 94% | Robust: 97%
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div>
                    <h3 style="margin-bottom: 1rem; color: var(--text-primary);">üìã Atividade Recente</h3>
                    <div style="max-height: 200px; overflow-y: auto;">
                        <div class="alert-item alert-info">
                            <strong>‚úÖ Verifica√ß√£o LGPD</strong><br>
                            Verifica√ß√£o autom√°tica completa. Score: 98%
                            <div class="timestamp">15:20:12</div>
                        </div>
                        
                        <div class="alert-item alert-info">
                            <strong>üßÆ Calculadora Validada</strong><br>
                            Rifampicina: 99.7% precis√£o em 150 casos
                            <div class="timestamp">15:18:45</div>
                        </div>
                        
                        <div class="alert-item alert-info">
                            <strong>üë• Novo Usu√°rio GA</strong><br>
                            Farmac√™utico iniciou tutorial educacional
                            <div class="timestamp">15:17:22</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="bottom-section">
            <!-- System Logs -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üìÑ Logs do Sistema</h2>
                    <button class="refresh-btn" onclick="refreshLogs()">Atualizar</button>
                </div>
                
                <div id="system-logs" style="max-height: 300px; overflow-y: auto;">
                    <div class="log-entry log-level-SUCCESS">
                        <span class="log-timestamp">[15:23:45]</span> SUCCESS: Medical precision validation completed - 99.4% average
                    </div>
                    
                    <div class="log-entry log-level-INFO">
                        <span class="log-timestamp">[15:23:30]</span> INFO: LGPD compliance check initiated
                    </div>
                    
                    <div class="log-entry log-level-SUCCESS">
                        <span class="log-timestamp">[15:23:15]</span> SUCCESS: WCAG accessibility scan - 96% compliance
                    </div>
                    
                    <div class="log-entry log-level-INFO">
                        <span class="log-timestamp">[15:22:58]</span> INFO: User session started - Persona: GA Learning
                    </div>
                    
                    <div class="log-entry log-level-SUCCESS">
                        <span class="log-timestamp">[15:22:45]</span> SUCCESS: Calculator validation - Rifampicina: 99.7%
                    </div>
                    
                    <div class="log-entry log-level-INFO">
                        <span class="log-timestamp">[15:22:30]</span> INFO: Auto-documentation generation completed
                    </div>
                </div>
            </div>

            <!-- Scientific Validation -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">üî¨ Valida√ß√£o Cient√≠fica</h2>
                    <button class="refresh-btn" onclick="refreshScientific()">Atualizar</button>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="value">100%</div>
                        <div class="label">Protocolos MS</div>
                    </div>
                    <div class="metric">
                        <div class="value">156</div>
                        <div class="label">Refer√™ncias</div>
                    </div>
                    <div class="metric">
                        <div class="value">99.8%</div>
                        <div class="label">Valida√ß√£o</div>
                    </div>
                    <div class="metric">
                        <div class="value">30d</div>
                        <div class="label">Atualiza√ß√£o</div>
                    </div>
                </div>
                
                <div style="margin-top: 1rem;">
                    <h4 style="margin-bottom: 0.75rem;">üìã Protocolos Atualizados</h4>
                    
                    <div class="calculator-item">
                        <div>
                            <strong>Minist√©rio da Sa√∫de 2024</strong>
                            <div class="timestamp">Diretrizes t√©cnicas atualizadas</div>
                        </div>
                        <div class="calculator-precision precision-excellent">‚úÖ Implementado</div>
                    </div>
                    
                    <div class="calculator-item">
                        <div>
                            <strong>OMS Guidelines 2024</strong>
                            <div class="timestamp">Estrat√©gias globais validadas</div>
                        </div>
                        <div class="calculator-precision precision-excellent">‚úÖ Conforme</div>
                    </div>
                    
                    <div class="calculator-item">
                        <div>
                            <strong>ANVISA RDC 301/2023</strong>
                            <div class="timestamp">Nomenclatura medicamentos</div>
                        </div>
                        <div class="calculator-precision precision-excellent">‚úÖ Atualizado</div>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">‚ö° Performance</h2>
                    <button class="refresh-btn" onclick="refreshPerformance()">Atualizar</button>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <h4>üìä M√©tricas √öltimas 2h</h4>
                </div>
                
                <div class="persona-stats" style="margin-bottom: 1rem;">
                    <div class="persona-card">
                        <div class="persona-header">
                            <span class="persona-icon">‚ö°</span>
                            <span class="persona-name">Geral</span>
                        </div>
                        <div class="persona-metrics">
                            <div>Uptime: <strong>99.9%</strong></div>
                            <div>Response: <strong>45ms</strong></div>
                            <div>Errors: <strong>0</strong></div>
                            <div>Requests: <strong>2.4k</strong></div>
                        </div>
                    </div>
                    
                    <div class="persona-card">
                        <div class="persona-header">
                            <span class="persona-icon">üì±</span>
                            <span class="persona-name">Mobile</span>
                        </div>
                        <div class="persona-metrics">
                            <div>PWA Score: <strong>94</strong></div>
                            <div>Offline: <strong>‚úÖ</strong></div>
                            <div>Touch: <strong>>44px</strong></div>
                            <div>Install: <strong>89%</strong></div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 style="margin-bottom: 0.5rem;">üéØ Thresholds</h4>
                    <div style="font-size: 0.875rem;">
                        <div>‚Ä¢ Precis√£o m√©dica: <span style="color: var(--success-color);">‚úÖ >95%</span></div>
                        <div>‚Ä¢ LGPD compliance: <span style="color: var(--success-color);">‚úÖ >95%</span></div>
                        <div>‚Ä¢ Acessibilidade: <span style="color: var(--success-color);">‚úÖ >90%</span></div>
                        <div>‚Ä¢ Performance LCP: <span style="color: var(--success-color);">‚úÖ <3s</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dashboard functionality
        let refreshInterval;
        let countdownInterval;
        let countdownSeconds = 30;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateTimestamp();
            startAutoRefresh();
            loadInitialData();
        });

        function updateTimestamp() {
            const now = new Date();
            const timestamp = now.toLocaleString('pt-BR', {
                day: '2-digit',
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            document.getElementById('last-update').textContent = `√öltima atualiza√ß√£o: ${timestamp}`;
        }

        function startAutoRefresh() {
            // Main refresh interval (30 seconds)
            refreshInterval = setInterval(() => {
                refreshAllData();
                countdownSeconds = 30;
            }, 30000);

            // Countdown interval (1 second)
            countdownInterval = setInterval(() => {
                countdownSeconds--;
                document.getElementById('refresh-countdown').textContent = `${countdownSeconds}s`;
                
                if (countdownSeconds <= 0) {
                    countdownSeconds = 30;
                }
            }, 1000);
        }

        function refreshAllData() {
            updateTimestamp();
            refreshMedicalData();
            refreshAlerts();
            refreshLogs();
            refreshScientific();
            refreshPerformance();
            
            // Add loading effect
            document.body.classList.add('loading');
            setTimeout(() => {
                document.body.classList.remove('loading');
            }, 500);
        }

        function refreshMedicalData() {
            // Simulate API call for medical data
            console.log('Refreshing medical data...');
            
            // Update calculator precisions (simulate small variations)
            const calculators = [
                { name: 'rifampicina', basePercent: 99.7 },
                { name: 'dapsona', basePercent: 99.2 },
                { name: 'esquema-pqt', basePercent: 99.8 },
                { name: 'baciloscopia', basePercent: 98.1 }
            ];
            
            calculators.forEach(calc => {
                const variation = (Math.random() - 0.5) * 0.4; // ¬±0.2% variation
                const newPercent = Math.max(95, Math.min(100, calc.basePercent + variation));
                // Update UI with new values
            });
            
            // Update precision average
            const avgPrecision = calculators.reduce((sum, calc) => sum + calc.basePercent, 0) / calculators.length;
            document.getElementById('precision-avg').textContent = `${avgPrecision.toFixed(1)}%`;
        }

        function refreshAlerts() {
            console.log('Refreshing alerts...');
            
            // Simulate checking for new alerts
            // In real implementation, this would call backend APIs
        }

        function refreshLogs() {
            console.log('Refreshing system logs...');
            
            // Add new log entry
            const logsContainer = document.getElementById('system-logs');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry log-level-INFO';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span> INFO: Dashboard refresh completed - All systems operational
            `;
            
            logsContainer.insertBefore(logEntry, logsContainer.firstChild);
            
            // Keep only last 10 entries
            while (logsContainer.children.length > 10) {
                logsContainer.removeChild(logsContainer.lastChild);
            }
        }

        function refreshScientific() {
            console.log('Refreshing scientific validation...');
            // In real implementation: check protocol updates, validate references
        }

        function refreshPerformance() {
            console.log('Refreshing performance metrics...');
            
            // Update active users (simulate variation)
            const currentUsers = parseInt(document.getElementById('active-users').textContent);
            const variation = Math.floor((Math.random() - 0.5) * 10); // ¬±5 users
            const newUsers = Math.max(0, currentUsers + variation);
            document.getElementById('active-users').textContent = newUsers.toString();
        }

        function loadInitialData() {
            // Simulate loading initial data
            console.log('Loading initial dashboard data...');
            
            // In a real implementation, this would:
            // 1. Fetch current system status
            // 2. Load medical calculator metrics
            // 3. Get LGPD compliance scores
            // 4. Load accessibility metrics
            // 5. Get recent logs and alerts
            // 6. Load performance data
        }

        // Export functionality (could be expanded)
        function exportMetrics() {
            const metrics = {
                timestamp: new Date().toISOString(),
                system_status: document.getElementById('system-status').textContent,
                precision_avg: document.getElementById('precision-avg').textContent,
                lgpd_score: document.getElementById('lgpd-score').textContent,
                accessibility_score: document.getElementById('accessibility-score').textContent,
                active_users: parseInt(document.getElementById('active-users').textContent)
            };
            
            const dataStr = JSON.stringify(metrics, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `medical-dashboard-metrics-${Date.now()}.json`;
            link.click();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+R: Manual refresh
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                refreshAllData();
            }
            
            // Ctrl+E: Export metrics
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                exportMetrics();
            }
        });

        // Accessibility: Announce important updates
        function announceUpdate(message) {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = message;
            
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                document.body.removeChild(announcement);
            }, 1000);
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Dashboard error:', e.error);
            
            // In production: send error to logging service
            // logError(e.error);
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) clearInterval(refreshInterval);
            if (countdownInterval) clearInterval(countdownInterval);
        });
    </script>
</body>
</html>